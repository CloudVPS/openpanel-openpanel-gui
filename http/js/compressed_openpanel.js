
var RPCError=function(message,status){var err=new Error(message)
if(!err.message){err.message=message}
if(status!=""){err.status=status;}else{err.status="";}
err.name="RPCError"
return err}
var OpenCoreError=function(message,errorCode){var err=new Error(message)
if(!err.message){err.message=message}
err.errorCode=errorCode!=undefined?errorCode:"";err.name="OpenCoreError"
return err}
var HTTPStatus={lookup:{100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"(Unused)",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"},getStatus:function(statusCode){var status=this.lookup[statusCode];if(status!=undefined){return status;}else{return"Unknown error ("+statusCode+")";}}}
var OpenCore={DataManager:{},Debug:{}}
var OpenPanel={Controller:{},GUIBuilder:{}}
var Throbber={maxFrames:12,i:1,timeout:200,targetDiv:{},start:function(){if(Throbber.throbberTimeout!=undefined){this.stop();}
if(Throbber.throbberTimeout==undefined)
{Throbber.throbberTimeout=setTimeout("Throbber.f()",this.timeout);}},stop:function(){clearTimeout(Throbber.throbberTimeout);Throbber.throbberTimeout=undefined;},f:function(){if(this.i<this.maxFrames){this.i++;}else{this.i=1;}
this.animate();this.start();},setTargetDiv:function(targetDiv){this.targetDiv=targetDiv;this.targetDiv.setAttribute("class","throbber");},animate:function()
{if(this.targetDiv.innerHTML.match('newTrobber')!=-1)
{var imageUrl="/images/gui/newTrobber.gif";this.targetDiv.innerHTML="<img src=\""+imageUrl+"\"/>";}}}
var STYLES={iconBar:{highliteItem:function(obj,hi_lo)
{if(typeof(obj)!='object')return;var _elm=document.getElementById(obj.id);elm=_elm.getElementsByTagName('TD');for(var x in elm)
{if(x=='iconTdLeft')
{if(hi_lo=='high')elm[x].style.backgroundImage="url(/images/gui/iconBarSelectedLeft.gif)";else elm[x].style.background="none";}
else if(x=='iconTdRight')
{if(hi_lo=='high')elm[x].style.backgroundImage="url(/images/gui/iconBarSelectedRight.gif)";else elm[x].style.background="none";}
else if(x=='iconTdMain')
{if(hi_lo=='high')elm[x].style.backgroundImage="url(/images/gui/iconBarSelectedMiddle.gif)";else elm[x].style.background="none";}}}},tab:{tab:function(obj)
{if(typeof(obj)!='object')return;obj.style.backgroundImage="url(/images/gui/tab_fill.gif)";obj.style.paddingLeft="5px";obj.style.paddingRight="5px";obj.style.lineHeight="21px";obj.style.height="21px";obj.style.cursor="default";},tabDelimiter:function(obj)
{if(typeof(obj)!='object')return;obj.style.backgroundImage="url(/images/gui/tab_delimiter.gif)";obj.style.height="21px";obj.style.width="1px";obj.style.cursor="default";},tabDelimiterSelected:function(obj)
{if(typeof(obj)!='object')return;obj.style.backgroundImage="url(/images/gui/tab_delimiter_selected.gif)";obj.style.height="21px";obj.style.width="1px";obj.style.cursor="default";},tabStartSelected:function(obj)
{if(typeof(obj)!='object')return;obj.style.backgroundImage="url(/images/gui/tab_start_selected.gif)";obj.style.height="21px";obj.style.width="10px";obj.style.cursor="default";},tabStart:function(obj)
{if(typeof(obj)!='object')return;obj.style.backgroundImage="url(/images/gui/tab_start.gif)";obj.style.height="21px";obj.style.width="10px";obj.style.cursor="default";},tabSelected:function(obj)
{if(typeof(obj)!='object')return;obj.style.backgroundImage="url(/images/gui/tab_hlite.gif)";obj.style.paddingLeft="5px";obj.style.paddingRight="5px";obj.style.lineHeight="21px";obj.style.height="21px";obj.style.cursor="default";},tabEndSelected:function(obj)
{if(typeof(obj)!='object')return;obj.style.backgroundImage="url(/images/gui/tab_end_selected.gif)";obj.style.height="21px";obj.style.width="10px";obj.style.cursor="default";},tabEnd:function(obj)
{if(typeof(obj)!='object')return;obj.style.backgroundImage="url(/images/gui/tab_end.gif)";obj.style.height="21px";obj.style.width="10px";obj.style.cursor="default";},tabDisabled:function(obj)
{return this.tab(obj);}}};OpenCore.DataManager={guiBuilder:{},controller:{},rpc:{},classInfos:undefined,sessionId:"",openCoreObjects:{},rootObject:{},errorId:0,errorMessage:"",quotaObject:{},quotaByClassName:{},setGuiBuilder:function(guiBuilder){this.guiBuilder=guiBuilder;},setController:function(controller){this.controller=controller;},setRPC:function(rpc){this.rpc=rpc;},login:function(userName,password){var r=new this.rpc.SendVars();r.addHeader("command","bind");r.addBody("data",{id:password});r.addBody("classid","User");r.addBody("id",userName);var requestResult=this.getRequestResult(r);if(requestResult.header!=undefined&&requestResult.header.session_id!=undefined){this.sessionId=requestResult.header.session_id;return true;}
return false;},loginAsync:function(userName,password,callBackObject,callBackFunction,callBackArguments){var r=new this.rpc.SendVars();r.addHeader("command","bind");r.addBody("data",{id:password});r.addBody("classid","User");r.addBody("id",userName);var callBackWrapper={callBackObject:callBackObject,callBackFunction:callBackFunction,callBackArguments:callBackArguments}
this.getRequestResultAsync(r,OpenCore.DataManager,"loginAsyncDone",callBackWrapper);},loginAsyncDone:function getInstancesByParentUUIDAsyncDone(callBackWrapper){var callBackObject;var callBackFunction;var callBackArguments={};var data;if(callBackWrapper.callBackObject!=undefined){callBackObject=callBackWrapper.callBackObject;}
if(callBackWrapper.callBackFunction!=undefined){callBackFunction=callBackWrapper.callBackFunction;}
if(callBackWrapper.callBackArguments!=undefined){callBackArguments=callBackWrapper.callBackArguments;}
if(callBackWrapper.data!=undefined){data=callBackWrapper.data;callBackArguments.data=data;}
var header=callBackWrapper.header;if(header.errorid==0){this.sessionId=callBackWrapper.header.session_id;}
if(callBackFunction==undefined){throw new Error("callBackFunction is undefined");}else{callBackObject[callBackFunction](data,callBackWrapper);}},initializeQuotaObject:function(){new OpenCore.DataManager.OpenCoreObject("ROOT","User");this.quotaObject=new OpenCore.DataManager.OpenCoreObject("User","OpenCORE:Quota")
this.quotaObject.getInstances();for(var metaid in this.quotaObject.instances){this.quotaByClassName[this.quotaObject.instances[metaid].metaid]=this.quotaObject.instances[metaid];}},checkQuotum:function(className){var quotum=this.quotaByClassName[className];console.log(quotum);if(quotum==undefined){return true;}else{if(quotum.usage<quotum.quota||quotum.quota==-1){return true;}else{return false;}}},getQuotumByClassName:function(className){var quotum=this.quotaByClassName[className];return quotum;},logOut:function(){var r=new this.rpc.SendVars();r.addHeader("command","logout");r.addHeader("session_id",this.sessionId);var requestResult=this.getRequestResult(r);if(requestResult.body!=undefined&&requestResult.body.data!=undefined&&requestResult.body.data[className]!=undefined){return requestResult.body.data;}},getClassInfo:function(className){if(this.classInfos==undefined||className=="ROOT"){var g=this.getWorld();try{if(g.body!=undefined&&g.body.data!=undefined&&g.body.data.body!=undefined&&g.body.data.body.classes!=undefined){this.classInfos=g.body.data.body.classes;}else{throw new Exception("ClassInfo was not found");}}catch(e){alert(e);}}
if(className=="ROOT"){var rootClassInfo={info:{children:{}}};for(var c in this.classInfos){var classInfo=this.classInfos[c];if(classInfo.info==undefined||(classInfo.info&&classInfo.info.parent==undefined)){rootClassInfo.info.children[classInfo["class"].uuid]={description:classInfo["class"].description,id:classInfo["class"].id,menuclass:classInfo["class"].menuclass,shortname:classInfo["class"].shortname}}}
this.classInfos["ROOT"]=rootClassInfo;}
return this.classInfos[className];},updateInstance:function(className,objectId,data){var r=new this.rpc.SendVars();r.addHeader("command","update");r.addHeader("session_id",this.sessionId);r.addBody("classid",className);r.addBody("objectid",objectId);r.addBody("data",data);var requestResult=this.getRequestResult(r);if(requestResult.body!=undefined&&requestResult.body.data!=undefined&&requestResult.body.data[className]!=undefined){return requestResult.body.data;}},updateInstanceAsync:function(className,objectId,data,callBackObject,callBackFunction,callBackArguments){var r=new this.rpc.SendVars();r.addHeader("command","update");r.addHeader("session_id",this.sessionId);r.addBody("classid",className);r.addBody("objectid",objectId);r.addBody("data",data);var callBackWrapper={callBackObject:callBackObject,callBackFunction:callBackFunction,callBackArguments:callBackArguments}
this.getRequestResultAsync(r,OpenCore.DataManager,"updateInstanceAsyncDone",callBackWrapper);},updateInstanceAsyncDone:function(callBackWrapper){console.log("callBackWrapper",callBackWrapper);var callBackObject;var callBackFunction;var callBackArguments;var data;if(callBackWrapper.callBackObject!=undefined){callBackObject=callBackWrapper.callBackObject;}
if(callBackWrapper.callBackFunction!=undefined){callBackFunction=callBackWrapper.callBackFunction;}
if(callBackWrapper.callBackArguments!=undefined){callBackArguments=callBackWrapper.callBackArguments;}
if(callBackWrapper.data!=undefined){data=callBackWrapper.data;}
callBackArguments.data=data;callBackArguments.header=callBackWrapper.header;if(callBackObject!=undefined){callBackObject[callBackFunction](callBackArguments);}},createInstance:function(className,objectId,parentId,data){var r=new this.rpc.SendVars();r.addHeader("command","create");r.addHeader("session_id",this.sessionId);r.addBody("classid",className);r.addBody("objectid",objectId);r.addBody("parentId",parentId);r.addBody("data",data);var requestResult=this.getRequestResult(r);if(requestResult.body!=undefined&&requestResult.body.data!=undefined&&requestResult.body.data[className]!=undefined){return requestResult.body.data;}},getRecords:function(className){var r=new this.rpc.SendVars();r.addHeader("command","getrecords");r.addHeader("session_id",this.sessionId);r.addBody("classid",className);var requestResult=this.getRequestResult(r);if(requestResult.body!=undefined&&requestResult.body.data!=undefined&&requestResult.body.data[className]!=undefined){return requestResult.body.data;}},getRecord:function(className,objectid){var r=new this.rpc.SendVars();r.addHeader("command","getrecord");r.addHeader("session_id",this.sessionId);r.addBody("classid",className);r.addBody("objectid",objectid);var requestResult=this.getRequestResult(r);if(requestResult.body!=undefined&&requestResult.body.data!=undefined&&requestResult.body.data.object!=undefined){return requestResult.body.data.object;}},getRecordAsync:function(className,objectId,callBackObject,callBackFunction,callBackArguments,background){var r=new OpenCore.RPC.SendVars();r.addHeader("command","getrecords");r.addHeader("session_id",OpenCore.DataManager.sessionId);r.addBody("classid",className);r.addBody("objectid",objectId);var callBackWrapper={callBackObject:callBackObject,callBackFunction:callBackFunction,callBackArguments:callBackArguments}
this.getRequestResultAsync(r,this,"getRecordsAsyncDone",callBackWrapper,background);},getReferences:function(refString){var r=new this.rpc.SendVars();r.addHeader("command","getreferences");r.addHeader("session_id",this.sessionId);r.addBody("refstring",refString);var requestResult=this.getRequestResult(r);if(requestResult.body!=undefined&&requestResult.body.data!=undefined){return requestResult.body.data;}},getInstancesByParentUUID:function(className,parentid){var r=new this.rpc.SendVars();r.addHeader("command","getrecords");r.addHeader("session_id",this.sessionId);r.addBody("classid",className);r.addBody("parentid",parentid);var requestResult=this.getRequestResult(r);if(requestResult.body!=undefined&&requestResult.body.data!=undefined&&requestResult.body.data[className]!=undefined){return requestResult.body.data;}},getInstancesByParentUUIDAsync:function(className,parentid,callBackObject,callBackFunction,callBackArguments){var r=new this.rpc.SendVars();r.addHeader("command","getrecords");r.addHeader("session_id",this.sessionId);r.addBody("classid",className);r.addBody("parentid",parentid);var callBackWrapper={callBackObject:callBackObject,callBackFunction:callBackFunction,callBackArguments:callBackArguments}
this.getRequestResultAsync(r,OpenCore.DataManager,"getInstancesByParentUUIDAsyncDone",callBackWrapper);},getInstancesByParentUUIDAsyncDone:function getInstancesByParentUUIDAsyncDone(callBackWrapper){var callBackObject;var callBackFunction;var callBackArguments={};var data;if(callBackWrapper.callBackObject!=undefined){callBackObject=callBackWrapper.callBackObject;}
if(callBackWrapper.callBackFunction!=undefined){callBackFunction=callBackWrapper.callBackFunction;}
if(callBackWrapper.callBackArguments!=undefined){callBackArguments=callBackWrapper.callBackArguments;}
if(callBackWrapper.data!=undefined){data=callBackWrapper.data;callBackArguments.data=data;}
if(callBackFunction==undefined){throw new Error("callBackFunctionis undefined");}else{callBackObject[callBackFunction](data,callBackArguments);}},getRecordByObjectId:function(className,objectId){var r=new this.rpc.SendVars();r.addHeader("command","getrecord");r.addHeader("session_id",this.sessionId);r.addBody("classid",className);r.addBody("objectid",objectId);var requestResult=this.getRequestResult(r);return requestResult;},getWorld:function(className){var r=new this.rpc.SendVars();r.addHeader("command","getworld");r.addHeader("session_id",this.sessionId);var requestResult=this.getRequestResult(r);return requestResult;},getRequestResult:function(sendVars){var r=jQuery.parseJSON(this.rpc.RequestHandler.synchronizedRequest(sendVars));if(r.header!=undefined&&r.header.errorid!=undefined&&r.header.error!=undefined){this.errorId=r.header.errorid;this.errorMessage=r.header.error;if(this.errorId!=0){throw new OpenCoreError(r.header.error,r.header.errorid);return;}
return r;}else{throw new RPCError("No response");}},getRequestResultAsync:function(sendVarsObject,callBackObject,callBackFunction,callBackArguments,background){var callBackWrapper={callBackObject:callBackObject,callBackFunction:callBackFunction,callBackArguments:callBackArguments}
this.rpc.RequestHandler.asynchronizedRequest(sendVarsObject,OpenCore.DataManager,"getRequestResultAsyncDone",callBackWrapper,background);},getRequestResultAsyncDone:function getRequestResultAsyncDone(callBackWrapper){if(callBackWrapper!=undefined){var callBackObject;var callBackFunction;var callBackArguments={};var data;if(callBackWrapper.callBackObject!=undefined){callBackObject=callBackWrapper.callBackObject;}
if(callBackWrapper.callBackFunction!=undefined){callBackFunction=callBackWrapper.callBackFunction;}
if(callBackWrapper.callBackArguments!=undefined){callBackArguments=callBackWrapper.callBackArguments;}
if(callBackWrapper.data!=undefined&&callBackWrapper.data.body!=undefined&&callBackWrapper.data.body.data!=undefined){data=callBackWrapper.data.body.data;callBackArguments.data=data;}
callBackArguments.header=callBackWrapper.data.header;if(callBackFunction==""){throw new Error("callBackFunction is not defined");}else{callBackObject[callBackFunction](callBackArguments);}}else{console.log("callBackWrapper undefined");}},getRecordsAsync:function(className,objectId,callBackObject,callBackFunction,callBackArguments,background){var r=new this.rpc.SendVars();r.addHeader("command","getrecords");r.addHeader("session_id",this.sessionId);r.addBody("classid",className);if(objectId!=undefined){r.addBody("objectid",objectId);}
var callBackWrapper={callBackObject:callBackObject,callBackFunction:callBackFunction,callBackArguments:callBackArguments}
this.getRequestResultAsync(r,OpenCore.DataManager,"getRecordsAsyncDone",callBackWrapper,background);},getRecordsAsyncDone:function(callBackWrapper){var callBackObject;var callBackFunction;var callBackArguments;var data;if(callBackWrapper.callBackObject!=undefined){callBackObject=callBackWrapper.callBackObject;}
if(callBackWrapper.callBackFunction!=undefined){callBackFunction=callBackWrapper.callBackFunction;}
if(callBackWrapper.callBackArguments!=undefined){callBackArguments=callBackWrapper.callBackArguments;}
if(callBackWrapper.data!=undefined){data=callBackWrapper.data;}
callBackArguments.data=data;if(callBackObject!=undefined){callBackObject[callBackFunction](callBackArguments);}},invokeMethodAsync:function(method,className,callBackObject,callBackFunction,callBackArguments){var r=new this.rpc.SendVars();r.addHeader("command","callmethod");r.addHeader("session_id",this.sessionId);r.addBody("method",method);r.addBody("classid",className);var callBackWrapper={callBackObject:callBackObject,callBackFunction:callBackFunction,callBackArguments:callBackArguments}
this.getRequestResultAsync(r,OpenCore.DataManager,"invokeMethodAsyncDone",callBackWrapper);},invokeMethodAsyncDone:function(callBackWrapper){var callBackObject;var callBackFunction;var callBackArguments;var data;console.log(callBackWrapper);if(callBackWrapper.callBackObject!=undefined){callBackObject=callBackWrapper.callBackObject;}
if(callBackWrapper.callBackFunction!=undefined){callBackFunction=callBackWrapper.callBackFunction;}
if(callBackWrapper.callBackArguments!=undefined){callBackArguments=callBackWrapper.callBackArguments;}
if(callBackWrapper.data!=undefined){data=callBackWrapper.data;}
callBackArguments.data=data;if(callBackObject!=undefined){callBackObject[callBackFunction](callBackArguments);}},getErrorId:function(){return this.errorId;},getErrorMessage:function(){return this.errorMessage;},getOpenCoreObjectByName:function(className){var r;if(this.openCoreObjects[className]!=undefined){r=this.openCoreObjects[className];}
return r;},deleteInstance:function(className,objectId){var r=new this.rpc.SendVars();r.addHeader("command","delete");r.addHeader("session_id",this.sessionId);r.addBody("classid",className);r.addBody("objectid",objectId);var requestResult=this.getRequestResult(r);return requestResult;},getOpenCoreObjectsByMetaName:function(metaName){var r=[];for(var className in this.openCoreObjects){var openCoreObject=this.openCoreObjects[className];if(openCoreObject.classInfo!=undefined&&openCoreObject.classInfo["class"]!=undefined&&openCoreObject.classInfo["class"].metabase==metaName){r.push(openCoreObject);}}
return r;}};OpenCore.Debug={debugObject:function(className){var openCoreObject=OpenCore.DataManager.getOpenCoreObjectByName(className);console.log(openCoreObject);var r=openCoreObject.getInstances();console.log(r);},createDebugList:function(){var elm=document.getElementById("debugList");elm.innerHTML="";this.buildList(elm,OpenCore.DataManager.rootObject);},buildList:function(elm,obj){if(typeof(obj)!="function"){var className=obj.name;var li=document.createElement("li");li.setAttribute("id",className);var liSpan=document.createElement("span");li.appendChild(liSpan);var liText=document.createTextNode(className);liSpan.onclick=function(){OpenCore.Debug.debugObject(this.parentNode.id)}
liSpan.appendChild(liText);elm.appendChild(li);if(obj.children!=undefined&&obj.children.length>0){var ul=document.createElement("ul");ul.setAttribute("id",className);li.appendChild(ul);for(var key in obj.children){var childObject=obj.children[key];this.buildList(ul,childObject);}}}},buildFormList:function(elm,obj){if(typeof(obj)!="function"&&obj.openCoreObject!=undefined){console.log(obj);var className=obj.openCoreObject.name;var li=document.createElement("li");li.setAttribute("id",className);var liSpan=document.createElement("span");li.appendChild(liSpan);var liText=document.createTextNode(className);liSpan.appendChild(liText);elm.appendChild(li);if(obj.childFormObjects!=undefined){var ul=document.createElement("ul");ul.setAttribute("id",className);li.appendChild(ul);for(var key in obj.childFormObjects){var childObject=obj.childFormObjects[key];this.buildFormList(ul,childObject);}}}},controllerDebug:function(controller){var elm=document.getElementById("controllerDebug");elm.innerHTML="[controller]";var hook=this;for(var key in controller){if(this.debugValues[key]!=undefined){var pElement=document.createElement("p");pElement.appendChild(document.createTextNode(key));var valueElement=this.createDebugLabel(controller,key);if(valueElement!=undefined){pElement.appendChild(valueElement);}
pElement.key=key;pElement.controller=controller;pElement.onclick=function(){console.log(this.controller[this.key]);}
elm.appendChild(pElement);}}
var elm2=document.getElementById("debugFormObjectList");if(elm2!=undefined){}
var elmC=elm2.childNodes;for(var i=0;i<elmC.length;i++){elm2.removeChild(elmC[i]);}
this.buildFormList(elm2,OpenPanel.GUIBuilder.GUIElements.FormBuilder.rootFormObject);},debugValues:{currentRootClassInstance:{value:"uuid"},lastCommand:{value:"__self__"},currentRootClass:{value:"name"},currentParentUUID:{value:"__self__"}},createDebugLabel:function(obj,key){var debugValue;if(this.debugValues[key]!=undefined){var val=this.debugValues[key].value;if(val=="__self__"){debugValue=obj[key];}else{if(obj[key]!=undefined&&obj[key][val]!=undefined){debugValue=obj[key][val];}}
if(debugValue!=undefined){var valP=document.createElement("p");valP.setAttribute("class","debugValue");valP.appendChild(document.createTextNode(debugValue));return valP;}}}}
OpenCore.RPC={sessionId:""}
OpenCore.RPC.RequestHandler={openCoreURL:"http://localhost:8888/fake-opencore-proxy/json",asynchronizedRequestCount:0,setOpenCoreURL:function(openCoreURL){this.openCoreURL=openCoreURL;},synchronizedRequest:function(sendVarsObject){var response=$j.ajax({type:"POST",url:this.openCoreURL,async:false,dataType:"json",data:jQuery.toJSON(sendVarsObject)});var responseText=response.responseText;if(response.status!=200){throw RPCError(HTTPStatus.getStatus(response.status),response.status);}
return responseText;},asynchronizedRequest:function(sendVarsObject,callBackObject,callBackFunction,callBackArguments,background){this.asynchronizedRequestCount++;if(background==undefined){OpenCore.RPC.RequestHandler.startLoading();}
var arg={callBackObject:callBackObject,callBackFunction:callBackFunction,callBackArguments:callBackArguments}
var hook=this;Ext.Ajax.request({url:hook.openCoreURL,success:this.asynchronizedRequestReturn,failure:this.asynchronizedRequestReturn,jsonData:jQuery.toJSON(sendVarsObject),argument:arg});},asynchronizedRequestReturn:function(requestResult){try{if(requestResult.status!=200){throw RPCError(HTTPStatus.getStatus(requestResult.status),requestResult.status);}
OpenCore.RPC.RequestHandler.asynchronizedRequestCount--;if(requestResult.argument!=undefined&&requestResult.argument.callBackObject!=undefined){var callBackObject=requestResult.argument.callBackObject;var callBackFunction=requestResult.argument.callBackFunction;var callBackArguments=requestResult.argument.callBackArguments;callBackArguments.data=Ext.util.JSON.decode(requestResult.responseText);if(callBackFunction==undefined){throw Error("callBackFunction does not exist");return;}else{if(callBackArguments!=undefined){callBackObject[callBackFunction](callBackArguments);}else{callBackObject[callBackFunction]();}}}
if(OpenCore.RPC.RequestHandler.asynchronizedRequestCount==0){OpenCore.RPC.RequestHandler.doneLoading();}}catch(e){OpenPanel.Controller.handleErrors(e);}},startLoading:function(){},doneLoading:function(){}}
OpenCore.RPC.SendVars=function(){this.header={};this.body={};this.init();}
OpenCore.RPC.SendVars.prototype={init:function(args){},addHeader:function(headerName,headerValue){this.header[headerName]=headerValue;},addBody:function(bodyName,bodyValue){this.body[bodyName]=bodyValue;}}
OpenPanel.Command={};OpenPanel.Controller={lastCommand:"",lastArgumentObject:{},dataManager:{},guiBuilder:{},selectedRootInstance:"",selectedTabObject:"",currentRootClass:{},currentRootClassInstance:{},currentUser:{},action:function(actionObject){console.log("controller actionObject",actionObject);try{this.lastCommand=actionObject.command;this.lastArgumentObject=actionObject;var actionObject=this.lastArgumentObject;var commandObject=OpenPanel.Command[actionObject.command];if(commandObject!=undefined){commandObject.controller=this;commandObject.execute(actionObject);}else{switch(actionObject.command){default:break;}}
console.log("---------------------------");}catch(e){this.handleErrors(e);}},setDataManager:function(dataManager){this.dataManager=dataManager;dataManager.setController(OpenPanel.Controller);},setGuiBuilder:function(guiBuilder){this.guiBuilder=guiBuilder;guiBuilder.setController(OpenPanel.Controller);for(var key in guiBuilder.GUIElements){if(guiBuilder.GUIElements[key].controller!=undefined){guiBuilder.GUIElements[key].controller=this;}}},showCreateInstance:function(openCoreObject,formObjectHolder,finishedAction){var popUpDiv=this.guiBuilder.createPopUp();var formObject=new OpenPanel.GUIBuilder.GUIElements.FormObject();formObject.setOpenCoreObject(openCoreObject);formObject.setTargetDiv(formObjectHolder);formObject.setController(this);formObject.createModalFields(openCoreObject,{},finishedAction,popUpDiv,{});formObject.fields.formPanel.enable();},showCreateInstanceFromFormObject:function(formObject,formObjectHolder,finishedAction){var d=document.createElement("div");var popUpDiv=this.guiBuilder.createPopUp();var popupFormObject=new OpenPanel.GUIBuilder.GUIElements.FormObject();popupFormObject.setOpenCoreObject(formObject.openCoreObject);popupFormObject.setTargetDiv(formObjectHolder);popupFormObject.setController(this);popupFormObject.createModalFields(formObject.openCoreObject,{},finishedAction,popUpDiv,formObject);popupFormObject.fields.formPanel.enable();},showCreateInstanceFromFormObjectMeta:function(formObject,openCoreObject,formObjectHolder,finishedAction){console.log(openCoreObject);var popUpDiv=this.guiBuilder.createPopUp();var popupFormObject=new OpenPanel.GUIBuilder.GUIElements.FormObject();popupFormObject.setOpenCoreObject(openCoreObject);popupFormObject.setTargetDiv(formObjectHolder);popupFormObject.setController(this);popupFormObject.createModalFields(openCoreObject,{},finishedAction,popUpDiv,formObject);popupFormObject.fields.formPanel.enable();},iconBarClick:function(openCoreObject){this.guiBuilder.GUIElements.ItemList.setOpenCoreObject(openCoreObject);this.guiBuilder.GUIElements.ItemList.build();this.tabBarClick(openCoreObject);},tabBarClick:function(openCoreObject){console.log("tabBarClick");if(openCoreObject.getFirstInstance()!=undefined){this.guiBuilder.GUIElements.TabBar.setOpenCoreObject(openCoreObject);this.guiBuilder.GUIElements.TabBar.build();var firstTabOpenCoreObject=this.guiBuilder.GUIElements.TabBar.getFirstTabItem();if(firstTabOpenCoreObject!=undefined){this.guiBuilder.GUIElements.FormBuilder.setOpenCoreObject(firstTabOpenCoreObject);this.guiBuilder.GUIElements.FormBuilder.setOpenCoreParentUUID(this.currentRootClassInstance.uuid);this.guiBuilder.GUIElements.FormBuilder.build();if(this.currentRootClassInstance!=undefined){this.guiBuilder.GUIElements.ItemList.highliteItem(this.currentRootClassInstance.uuid);}
this.guiBuilder.GUIElements.TabBar.highliteItem(firstTabOpenCoreObject.name);}else{this.guiBuilder.GUIElements.FormBuilder.setOpenCoreObject(openCoreObject);}}else{this.guiBuilder.GUIElements.TabBar.setOpenCoreObject(openCoreObject);this.guiBuilder.GUIElements.TabBar.build();this.guiBuilder.GUIElements.TabBar.disable();this.guiBuilder.GUIElements.FormBuilder.clean();}},initializePing:function(){if(this.pingTimeoutHandler==undefined){this.pingTimeoutHandler=setTimeout("OpenPanel.Controller.ping()",60000);}},destroyPingTimeoutHandler:function(){if(this.pingTimeoutHandler!=undefined){clearTimeout(this.pingTimeoutHandler);this.pingTimeoutHandler=undefined;}},ping:function(){console.log("ping");this.dataManager.getRecordsAsync("ping",undefined,OpenPanel.Controller,"pingDone",{},true);},pingDone:function(callBackArguments){try{if(callBackArguments.data==undefined){var d="";for(var key in callBackArguments){d+=key+" "+callBackArguments[key]+"\n";}
throw new Error("Unexpected server reply (opencore gone?): "+d);}else{if(OpenCore.DataManager.getErrorId()==0){OpenPanel.Controller.destroyPingTimeoutHandler();OpenPanel.Controller.initializePing();}else if(OpenCore.DataManager.errorId==12288){OpenPanel.Controller.action("Init");}else{errorMsg=OpenCore.DataManager.getErrorMessage();OpenPanel.Controller.destroyPingTimeoutHandler();throw new Error(errorMsg);}}}catch(e){this.handleErrors(e);}},handleErrors:function(e){OpenPanel.GUIBuilder.hideLoadingDiv();clearTimeout(this.pingTimeoutHandler);switch(e.name){case"OpenCoreError":if(e.threaded==true){var errors=e.errors;var errorString="";var goToInit=false;for(var i=0;i<errors.length;i++){var error=errors[i];if(typeof(error)=="object"){errorString+=error.errorId+" : "+error.error+"\n";if(error.errorId==12288||error.errorId==8193){goToInit=true;}}}
alert(errorString);if(goToInit==true){this.action({command:"Init",msg:e.message})
OpenPanel.Controller.proceedAfterError();}}else{switch(e.errorCode){case 12288:case 8193:alert(e);this.action({command:"Init",msg:e.message})
OpenPanel.Controller.proceedAfterError();break;default:alert(e);break;}}
break;case"RPCError":default:var targetDiv=OpenPanel.GUIBuilder.createPopUp();this.error=new Array();for(var errorKey in e){this.error.push([errorKey,e[errorKey]]);}
OpenPanel.GUIBuilder.loadTemplateIntoDiv("templates/fatalError.html",targetDiv);break;}
for(var key in e){console.log(key+": "+e[key]);}},proceedAfterError:function(){OpenPanel.GUIBuilder.hideModalMessageDiv();OpenPanel.Controller.initializePing();}}
OpenPanel.GUIBuilder={GUIElements:{},dataManager:{},controller:{},selectedTab:"",popUpDiv:{},targetDiv:{},lastAnchor:"",setController:function(controller){this.controller=controller;},loadTemplate:function(templateName,targetDivName){var targetDiv=document.getElementById(targetDivName);if(targetDiv!=undefined){OpenPanel.GUIBuilder.loadTemplateIntoDiv(templateName,targetDiv);}else{alert("OpenPanel.GUIBuilder : targetDiv not found");}},loadTemplateIntoDiv:function(templateName,targetDiv){var f=$j.ajax({type:"POST",url:templateName,async:false,dataType:"text"}).responseText;var o=TrimPath.parseTemplate(f);this.targetDiv=targetDiv;this.targetDiv.innerHTML=o.process({controller:this.controller});},createPopUp:function(){this.enterModalMode();this.showModalMessageDiv();var previousPopUpDiv=document.getElementById("popup");var modalMessageDiv=document.getElementById("modalMessageContent");if(previousPopUpDiv!=undefined){modalMessageDiv.removeChild(previousPopUpDiv);}
var popUpDiv=document.createElement("div");popUpDiv.setAttribute("id","popup");modalMessageDiv.appendChild(popUpDiv);return popUpDiv;},deletePopUp:function(){this.exitModalMode();this.hideModalMessageDiv();var modalMessageDiv=document.getElementById("modalMessageContent");var previousPopUpDiv=document.getElementById("popup");if(previousPopUpDiv!=undefined){modalMessageDiv.removeChild(previousPopUpDiv);}},renderLogin:function(el,params){var hook=this;if(params!=undefined&&params.msg!=undefined){}
var simple=new Ext.FormPanel({labelWidth:75,submit:function(){var obj={};for(var key in this.items.items){var item=this.items.items[key];if(typeof(item)=="object"){var name=item.getName();var value=item.getValue();var initValue=item.initValue();obj[name]=value;}}
obj.command="Login";hook.controller.action(obj);},frame:true,title:'Log in',bodyStyle:'padding:5px 5px 0',width:290,defaults:{width:170},defaultType:'textfield',buttonAlign:"right",shadow:"frame",shadowOffset:3,formId:"loginForm",monitorValid:true,items:[{fieldLabel:'Username',name:'userName',allowBlank:false,value:params.userName!=undefined?params.userName:""},{fieldLabel:'Password',name:'password',inputType:'password',allowBlank:false,value:params.password!=undefined?params.password:""}],buttons:[{text:'Ok',handler:function(){simple.submit();},formBind:true}]});simple.render(el);simple.setPosition(100,10);},enterModalMode:function(){var modalDiv=document.getElementById("modal");modalDiv.style.visibility="visible";OpenPanel.GUIBuilder.onresize();window.onresize=OpenPanel.GUIBuilder.onresize;},exitModalMode:function(){var modalDiv=document.getElementById("modal");modalDiv.style.visibility="hidden";window.onresize={}},showModalMessageDiv:function(){var modalMessageDiv=document.getElementById("modalMessageDiv");modalMessageDiv.style.visibility="visible";},hideModalMessageDiv:function(){console.log("hideModalMessageDiv");var modalMessageDiv=document.getElementById("modalMessageDiv");modalMessageDiv.style.visibility="hidden";},showLoadingDiv:function(){OpenPanel.GUIBuilder.enterModalMode();var loadingDiv=document.getElementById("modalLoadingDiv");Throbber.setTargetDiv(loadingDiv);Throbber.start();loadingDiv.style.visibility="visible";},hideLoadingDiv:function(){OpenPanel.GUIBuilder.exitModalMode();var loadingDiv=document.getElementById("modalLoadingDiv");loadingDiv.style.visibility="hidden";Throbber.stop();},onresize:function(){var modalDiv=document.getElementById("modal");var windowSizes=OpenPanel.GUIBuilder.getWindowSize();console.log("windowSizes",windowSizes);modalDiv.style.width=windowSizes.width+"px";modalDiv.style.height=windowSizes.height+"px";},getWindowSize:function(){var myWidth=0,myHeight=0;if(typeof(window.innerWidth)=='number'){myWidth=window.outerWidth;myHeight=window.innerHeight;}else if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){myWidth=document.documentElement.clientWidth;myHeight=document.documentElement.clientHeight;}else if(document.body&&(document.body.clientWidth||document.body.clientHeight)){myWidth=document.body.clientWidth;myHeight=document.body.clientHeight;}
return{width:myWidth-4,height:myHeight-8}},drawGroup:function(){var groupHolder=document.createElement("div");groupHolder.setAttribute("class","groupHolder");var table=document.createElement("table");table.setAttribute("class","groupTable");table.setAttribute("cellpadding","0");table.setAttribute("cellspacing","0");groupHolder.appendChild(table);var tBody=document.createElement("tbody");table.appendChild(tBody);var topTr=document.createElement("tr");tBody.appendChild(topTr);var topLeftTd=document.createElement("td");topLeftTd.setAttribute("class","groupTopLeft");topTr.appendChild(topLeftTd);var topCenterTd=document.createElement("td");topCenterTd.setAttribute("class","groupTopCenter");topTr.appendChild(topCenterTd);var topRightTd=document.createElement("td");topRightTd.setAttribute("class","groupTopRight");topTr.appendChild(topRightTd);var centerTr=document.createElement("tr");tBody.appendChild(centerTr);var centerLeftTd=document.createElement("td");centerLeftTd.setAttribute("class","groupCenterLeft");centerTr.appendChild(centerLeftTd);var centerMiddleTd=document.createElement("td");centerMiddleTd.setAttribute("class","groupCenterMiddle");centerTr.appendChild(centerMiddleTd);var centerRightTd=document.createElement("td");centerRightTd.setAttribute("class","groupCenterRight");centerTr.appendChild(centerRightTd);var bottomTr=document.createElement("tr");tBody.appendChild(bottomTr);var bottomLeftTd=document.createElement("td");bottomLeftTd.setAttribute("class","groupBottomLeft");bottomTr.appendChild(bottomLeftTd);var bottomCenterTd=document.createElement("td");bottomCenterTd.setAttribute("class","groupBottomMiddle");bottomTr.appendChild(bottomCenterTd);var bottomRightTd=document.createElement("td");bottomRightTd.setAttribute("class","groupBottomRight");bottomTr.appendChild(bottomRightTd);return{groupHolder:groupHolder,contentDiv:centerMiddleTd}},goToAnchor:function(anchor){this.lastAnchor=anchor;console.log("anchor",anchor);if(anchor!=undefined&&anchor!=""){window.location.hash=anchor;}},getLastAnchor:function(){return this.lastAnchor;},goToLastAnchor:function(){this.goToAnchor(this.lastAnchor);}}
OpenCore.DataManager.OpenCoreObject=function(parent,name){this.uuid="";this.parent;this.name="";this.children=[];this.classInfo=undefined;this.instances={};this.fetchedInstances=false;this.currentInstance={};this.description="";this.openCoreObjects={};this.singleton=false;this.singletonValue="";this.indexing="";this.meta=false;this.metaValue="";this.canDelete=false;this.canCreate=false;this.canUpdate=false;this.canGetInfo=false;this.isRootObject=false;this.title="";this.childCount=0;this.init(parent,name);if(name=="ROOT"){OpenCore.DataManager.rootObject=this;}}
OpenCore.DataManager.OpenCoreObject.prototype={init:function(parent,name){this.parent=parent;this.name=name;if(OpenCore.DataManager.OpenCoreObject.openCoreObjects==undefined){OpenCore.DataManager.OpenCoreObject.openCoreObjects={};OpenCore.DataManager.openCoreObjects=OpenCore.DataManager.OpenCoreObject.openCoreObjects;}
OpenCore.DataManager.OpenCoreObject.openCoreObjects[name]=this;this.getClassInfo();if(name!="ROOT"){this.description=this.classInfo["class"].description;if(this.classInfo["class"].singleton!=""){this.singleton=true;this.singletonValue=this.classInfo["class"].singleton;}
this.indexing=this.classInfo["class"].indexing;this.metaType=this.classInfo["class"].metatype;this.meta=this.metaType=="base"?true:false;this.title=this.classInfo["class"].title;if(this.classInfo.capabilities!=undefined){this.canDelete=this.classInfo.capabilities["delete"];this.canCreate=this.classInfo.capabilities.create;this.canUpdate=this.classInfo.capabilities.update;this.canGetInfo=this.classInfo.capabilities.getInfo;}
this.uuid=this.classInfo["class"].uuid;if(this.classInfo.info!=undefined&&this.classInfo.info.parent==undefined){this.isRootObject=true;}}},getParameterCount:function(){var i=0;for(var key in this.classInfo.structure.parameters){i++;}
return i;},getObjectByName:function(name){if(OpenCore.DataManager.OpenCoreObject.openCoreObjects[name]!=undefined){return OpenCore.DataManager.OpenCoreObject.openCoreObjects[name];}},getClassInfo:function(){if(this.classInfo==undefined){this.classInfo=OpenCore.DataManager.getClassInfo(this.name);}
return this.classInfo;},getChildren:function(){this.getClassInfo();this.children=[];if(this.classInfo.info!=undefined&&this.classInfo.info.children!=undefined){var childrenInfo=this.classInfo.info.children;for(var key in childrenInfo){this.childCount++;var childInfo=childrenInfo[key];var childClassName=childInfo.id;var childClass=new OpenCore.DataManager.OpenCoreObject(this,childClassName);this.children.push(childClass);childClass.getChildren();}}},setCurrentInstance:function(instance){this.currentInstance=instance;},getCurrentInstance:function(uuid){this.currentInstance=OpenCore.DataManager.getRecordByUUID(this.name,uuid);if(this.currentInstance!=undefined){return this.currentInstance;}},setHasFetchedInstances:function(state){this.fetchedInstances=state;},getInstances:function(){if(this.fetchedInstances==false){this.instances={};this.fetchedInstances=true;var r=OpenCore.DataManager.getRecords(this.name);if(r!=undefined){this.instances=r[this.name];}}
return this.instances;},getInstancesAsync:function(callBackObject,callBackFunction,callBackArguments){if(this.fetchedInstances==false){var callBackWrapper={callBackObject:callBackObject,callBackFunction:callBackFunction,callBackArguments:callBackArguments}
OpenCore.DataManager.getRecordsAsync(this.name,undefined,this,"getInstancesAsyncDone",callBackWrapper);}
return this.instances;},getInstancesAsyncDone:function(callBackWrapper){console.log("getInstancesAsyncDone");console.log(callBackWrapper);console.log(this.name);if(callBackWrapper!=undefined&&callBackWrapper.data!=undefined){this.fetchedInstances=true;this.instances=callBackWrapper.data[this.name];console.log("INSTANCES",this.instances,this);}
var callBackObject;var callBackFunction;var callBackArguments={};var data;console.log("OpenCoreObject instances ",this.instances);if(callBackWrapper.callBackObject!=undefined){callBackObject=callBackWrapper.callBackObject;}
if(callBackWrapper.callBackFunction!=undefined){callBackFunction=callBackWrapper.callBackFunction;}
if(callBackWrapper.callBackArguments!=undefined){callBackArguments=callBackWrapper.callBackArguments;}
if(callBackWrapper.data!=undefined){data=callBackWrapper.data;callBackArguments.data=data;}
if(callBackFunction==""){throw new Error("callBackFunction is not defined");}else{callBackObject[callBackFunction](callBackArguments);}},getInstancesByParentUUID:function(uuid){if(this.fetchedInstances==false){this.instances={};this.fetchedInstances=true;var r=OpenCore.DataManager.getInstancesByParentUUID(this.name,uuid);if(r!=undefined){this.instances=r[this.name];console.log(this.instances);}}
return this.instances;},getInstanceByUUID:function(uuid){if(this.fetchedInstances==false){this.getInstances();console.log("this.instances",this.instances);for(var metaId in this.instances){var instance=this.instances[metaId];console.log("instance",instance);if(instance.uuid==uuid){return instance;}}}},getInstancesByParentUUIDAsync:function(uuid,callBackObject,callBackFunction,callBackArguments){if(this.fetchedInstances==false){this.instances={};this.fetchedInstances=true;var callBackWrapper={callBackObject:callBackObject,callBackFunction:callBackFunction,callBackArguments:callBackArguments}
OpenCore.DataManager.getInstancesByParentUUIDAsync(this.name,uuid,this,"getInstancesByParentUUIDAsyncDone",callBackWrapper);}},getInstancesByParentUUIDAsyncDone:function getInstancesByParentUUIDAsyncDone(resultObject,callBackWrapper){if(resultObject!=undefined){console.log(resultObject);this.instances=resultObject[this.name];}
var callBackObject;var callBackFunction;var callBackArguments={};var data;if(callBackWrapper!=undefined){if(callBackWrapper.callBackObject!=undefined){callBackObject=callBackWrapper.callBackObject;}
if(callBackWrapper.callBackFunction!=undefined){callBackFunction=callBackWrapper.callBackFunction;}
if(callBackWrapper.callBackArguments!=undefined){callBackArguments=callBackWrapper.callBackArguments;}
if(callBackWrapper.data!=undefined){data=callBackWrapper.data;callBackArguments.data=data;}
if(callBackFunction==undefined){throw new Error("callBackFunction.name is undefined");}else{callBackObject[callBackFunction](callBackArguments);}}else{}},getInstanceByUUID:function(uuid){this.getInstances();for(var key in this.getInstances()){if(this.instances[key].uuid==uuid){return this.instances[key];}}},getFirstInstance:function(){this.getInstances();console.log("instances again",this.instances,this);for(var key in this.instances){return this.instances[key];}},getOffSpring:function(){this.getChildren();for(var key in this.children){var child=this.children[key];if(typeof(child)=="object"){child.getOffSpring();}}},getChildCount:function(){return this.childCount;}}
OpenPanel.Command.BuildIconBar={controller:{},execute:function(actionObject){this.controller.dataManager.rootObject.getChildren();this.controller.guiBuilder.GUIElements.IconBar.setOpenCoreObject(this.controller.dataManager.rootObject);this.controller.guiBuilder.GUIElements.IconBar.build();}}
OpenPanel.Command.ClickGridItem={controller:{},execute:function(actionObject){console.log(actionObject);var formObject=actionObject.formObject;var instance=actionObject.instance;console.log("clickGridItem "+instance["class"]+formObject.openCoreObject.name);var actualInstance;formObject.setCurrentInstance(instance);if(formObject.openCoreObject.meta==true){var record=this.controller.dataManager.getRecord(instance["class"],instance.id);instance=record[instance["class"]];if(instance!=undefined){formObject.currentMetaInstance=instance;}else{}}
actualInstance=instance;console.log(instance);var openCoreObject=this.controller.dataManager.getOpenCoreObjectByName(actualInstance["class"]);console.log("clickGridItem2 "+openCoreObject.name);formObject.createFields(openCoreObject,actualInstance,"",formObject.fieldsDiv);formObject.childFormObjectsDiv.innerHTML="";var first=true;for(var childOpenCoreObjectName in openCoreObject.children){var childOpenCoreObject=openCoreObject.children[childOpenCoreObjectName];var someDiv=document.createElement("div");formObject.childFormObjectsDiv.appendChild(someDiv);if(typeof(childOpenCoreObject)=="object"&&childOpenCoreObject.classInfo["class"].metabase==""){formObject.createChildFormObject(childOpenCoreObject,actualInstance.uuid,someDiv,this.controller);if(first==true){first=false;}}}
OpenPanel.GUIBuilder.goToAnchor(formObject.openCoreObject.name);}}
OpenPanel.Command.ClickIconBarItem={controller:{},clickedIconBarItem:{},execute:function(actionObject){var openCoreObject=this.controller.dataManager.getOpenCoreObjectByName(actionObject.className);if(openCoreObject!=undefined){var test=document.getElementById("mainAreaLeft");if(test==undefined){OpenPanel.Command.Login.buildMainArea();this.controller.guiBuilder.GUIElements.IconBar.highliteItem(openCoreObject.name);this.controller.guiBuilder.GUIElements.IconBar.setTitle(openCoreObject.title);}
openCoreObject.setHasFetchedInstances(false);openCoreObject.getInstancesAsync(OpenPanel.Command.ClickIconBarItem,"getInstancesDone",openCoreObject);this.clickedIconBarItem=openCoreObject;}else{throw new Error("openCoreObject is undefined")}},getInstancesDone:function(openCoreObject){var mekker=openCoreObject.getFirstInstance();this.controller.currentRootClass=openCoreObject;this.controller.currentRootClassInstance=openCoreObject.getFirstInstance();this.controller.iconBarClick(openCoreObject);}}
OpenPanel.Command.ClickItemListItem={controller:{},execute:function(actionObject){var openCoreObject=this.controller.dataManager.getOpenCoreObjectByName(actionObject.className);if(openCoreObject!=undefined){console.log("opencoreobject",openCoreObject);this.controller.currentParentUUID=actionObject.instanceUUID;this.controller.currentRootClassInstance=openCoreObject.getInstanceByUUID(actionObject.instanceUUID);this.controller.guiBuilder.GUIElements.FormBuilder.setOpenCoreParentUUID(this.controller.currentRootClassInstance.uuid);this.controller.guiBuilder.GUIElements.FormBuilder.build();}}}
OpenPanel.Command.ClickTabBarItem={controller:{},execute:function(actionObject){var openCoreObject=this.controller.dataManager.getOpenCoreObjectByName(actionObject.className);if(openCoreObject!=undefined&&this.controller.currentRootClassInstance!=undefined&&this.controller.currentRootClassInstance.uuid!=undefined)
{this.controller.currentRootClass=openCoreObject;this.controller.guiBuilder.GUIElements.FormBuilder.setOpenCoreObject(openCoreObject);this.controller.guiBuilder.GUIElements.FormBuilder.setOpenCoreParentUUID(this.controller.currentRootClassInstance.uuid);this.controller.guiBuilder.GUIElements.FormBuilder.build();}}}
OpenPanel.Command.CreateInstanceFromFormObject={controller:{},execute:function(actionObject){if(actionObject.openCoreObject!=undefined&&actionObject.formValues!=undefined){var className=actionObject.openCoreObject.name;var actionObjectId=actionObject.formValues.id;var parentId=actionObject.optionalCallBackObject.parentUUID;var r=this.controller.dataManager.createInstance(className,actionObjectId,parentId,actionObject.formValues);if(this.controller.dataManager.errorId==0){actionObject.optionalCallBackObject.openCoreObject.fetchedInstances=false;actionObject.optionalCallBackObject.openCoreObject.getInstances();actionObject.optionalCallBackObject.build();this.controller.guiBuilder.deletePopUp();}else{throw new Error(this.controller.dataManager.errorMessage);}}}}
OpenPanel.Command.CreateInstanceFromItemList={controller:{},execute:function(actionObject){if(actionObject.openCoreObject!=undefined&&actionObject.formValues!=undefined){var className=actionObject.openCoreObject.name;var openCoreObject=this.controller.dataManager.getOpenCoreObjectByName(className);var actionObjectId=actionObject.formValues.id;var parentId=actionObject.openCoreObject.parent.uuid;var r=this.controller.dataManager.createInstance(className,actionObjectId,parentId,actionObject.formValues);if(this.controller.dataManager.errorId==0){openCoreObject.fetchedInstances=false;var instances=openCoreObject.getInstances();for(var key in instances){console.log(key,instances[key]);}
this.controller.currentRootClassInstance=openCoreObject.instances[actionObjectId];console.log("this.currentRootClassInstance",this.controller.currentRootClassInstance);this.controller.iconBarClick(openCoreObject);this.controller.guiBuilder.deletePopUp();}else{throw new Error(this.controller.dataManager.errorMessage);}}}}
OpenPanel.Command.DeleteInstance={controller:{},execute:function(actionObject){if(actionObject.openCoreObject!=undefined&&actionObject.instance!=undefined){var actionObjectId=actionObject.instance.uuid;var className=actionObject.openCoreObject.name;var r=this.controller.dataManager.deleteInstance(className,actionObjectId);if(this.controller.dataManager.errorId==0){actionObject.openCoreObject.fetchedInstances=false;actionObject.openCoreObject.getInstances();this.controller.currentRootClassInstance=actionObject.openCoreObject.getFirstInstance();this.controller.iconBarClick(actionObject.openCoreObject);}else{throw new Error(this.dataManager.errorMessage);}}}}
OpenPanel.Command.DeleteInstanceFromFormObject={controller:{},execute:function(actionObject){if(actionObject.openCoreObject!=undefined&&actionObject.formObject!=undefined){var openCoreObject=actionObject.openCoreObject;var formObject=actionObject.formObject;var instance;var className;if(openCoreObject.meta==true){instance=formObject.currentMetaInstance;className=instance["class"];}else{instance=formObject.currentInstance;className=openCoreObject.name;}
this.controller.dataManager.deleteInstance(className,instance.uuid);console.log(instance.uuid+" "+className);openCoreObject.fetchedInstances=false;openCoreObject.getInstances();formObject.build();}}}
OpenPanel.Command.Init={controller:{},execute:function(actionObject){if(Ext.isGecko||Ext.isSafari||1){this.controller.guiBuilder.hideModalMessageDiv();this.controller.guiBuilder.loadTemplate("templates/login.html","app");this.controller.guiBuilder.renderLogin(document.getElementById("loginDiv"),actionObject);}else{var e=new Error();e.message="Unsupported browser.";e.description="Unfortunately this browser is not supported. IE and Opera support will be implemented in upcoming release candidates. Please try <a href=\"http://www.apple.com/safari/download/\">Safari</a> or <a href=\"http://www.getfirefox.com\">Firefox</a>. ";e.status=-1;throw e;}}}
OpenPanel.Command.InvokeMethod={controller:{},execute:function(actionObject){console.log(actionObject);var openCoreObject=actionObject.openCoreObject;var className=openCoreObject.name;var methodName=actionObject.methodName;this.controller.dataManager.invokeMethodAsync(methodName,className,this,"done",{});},done:function(args){console.log(args);}}
OpenPanel.Command.Login={controller:{},execute:function(actionObject){if(actionObject.userName!=undefined&&actionObject.password!=undefined){this.controller.dataManager.loginAsync(actionObject.userName,actionObject.password,this,"loginDone",actionObject);}},loginDone:function(data,callBackArguments){var actionObject=callBackArguments;if(callBackArguments.header.errorid==0){var rootObject=new OpenCore.DataManager.OpenCoreObject({},"ROOT");this.controller.currentUser=actionObject.callBackArguments.userName;this.buildMainArea();OpenPanel.Controller.initializePing();this.controller.action({command:"Welcome"});}else{throw new OpenCoreError(callBackArguments.header.error,callBackArguments.header.errorid);}},buildMainArea:function(){this.controller.guiBuilder.loadTemplate("templates/main.html","app");this.controller.guiBuilder.GUIElements.FormBuilder.setSaveButtonVisibility(false);OpenPanel.GUIBuilder.GUIElements.IconBar.setTargetDivName("iconBar");OpenPanel.GUIBuilder.GUIElements.ItemList.setTargetDivName("mainAreaLeft");OpenPanel.GUIBuilder.GUIElements.TabBar.setTargetDivName("tabBar");OpenPanel.GUIBuilder.GUIElements.FormBuilder.setTargetDivName("mainAreaForm");this.controller.action({command:"BuildIconBar"});}}
OpenPanel.Command.Logout={controller:{},execute:function(actionObject){this.controller.dataManager.logOut();this.controller.destroyPingTimeoutHandler();this.controller.action({command:"Init"});}}
OpenPanel.Command.SaveForm={controller:{},execute:function(actionObject){var newActionObject={};var transport=actionObject.transport;newActionObject.numberOfChildObjects=transport.length;newActionObject.done=0;newActionObject.errors=[];newActionObject.failed=false;newActionObject.command="SaveFormDone";for(var i=0;i<transport.length;i++){var openCoreObject=transport[i].openCoreObject;var formData=transport[i].formData;var instance=transport[i].instance;newActionObject.openCoreObject=openCoreObject;this.controller.dataManager.updateInstanceAsync(openCoreObject.name,instance.uuid,formData,this.controller,"action",newActionObject);}
console.log(actionObject.transport);}}
OpenPanel.Command.SaveFormDone={controller:{},execute:function(actionObject){console.log(actionObject.header.errorid);var errorId=actionObject.header.errorid;actionObject.done++;if(errorId!=0){var error=actionObject.header.error;actionObject.failed=true;actionObject.errors.push({error:error,errorId:errorId});}
if(actionObject.done==actionObject.numberOfChildObjects){try{if(actionObject.failed==true){var errorString="";for(var i=0;i<actionObject.errors.length;i++){errorString+=actionObject.errors[i]+"<br/>";}
var e=new OpenCoreError(errorString);e.threaded=true;e.errors=actionObject.errors;throw e;}
OpenPanel.GUIBuilder.GUIElements.FormBuilder.rootFormObject.build();}catch(e){this.controller.handleErrors(e);}}}}
OpenPanel.Command.ShowCreateInstanceFromFormObject={controller:{},execute:function(actionObject){this.controller.showCreateInstanceFromFormObject(actionObject.formObject,actionObject.formObjectHolder,"CreateInstanceFromFormObject");}}
OpenPanel.Command.ShowCreateInstanceFromFormObjectMeta={controller:{},execute:function(actionObject){if(actionObject.formObject!=undefined&&actionObject.openCoreObject!=undefined&&actionObject.openCoreObject!=undefined){this.controller.showCreateInstanceFromFormObjectMeta(actionObject.formObject,actionObject.openCoreObject,actionObject.formObjectHolder,"CreateInstanceFromFormObject");}}}
OpenPanel.Command.ShowCreateInstanceFromItemList={controller:{},execute:function(actionObject){this.controller.showCreateInstance(actionObject.openCoreObject,actionObject.formObjectHolder,"CreateInstanceFromItemList");}}
OpenPanel.Command.ShowDeleteInstanceFromFormObject={controller:{},execute:function(actionObject){actionObject.command="DeleteInstanceFromFormObject";this.controller.action(actionObject);}}
OpenPanel.Command.Welcome={controller:{},execute:function(actionObject){var tabBarDiv=document.getElementById("tabBar");if(tabBarDiv!=undefined){tabBarDiv.innerHTML="";}
var mainAreaDiv=document.getElementById("mainArea");mainAreaDiv.innerHTML="";var welcomeDivHolder=document.createElement("div");welcomeDivHolder.setAttribute("id","welcomeDivHolder");mainAreaDiv.appendChild(welcomeDivHolder);this.controller.guiBuilder.loadTemplate("dynamic/","welcomeDivHolder");this.controller.guiBuilder.GUIElements.IconBar.highliteItem("Welcome");this.controller.guiBuilder.GUIElements.IconBar.setTitle("Welcome");this.controller.guiBuilder.GUIElements.FormBuilder.setSaveButtonVisibility(false);}}
OpenPanel.GUIBuilder.GUIElements.FormBuilder={targetDiv:{},openCoreObject:{},parentUUID:"",rootFormObject:{},controller:{},currentRootClassInstance:{},currentInstances:{},isUpdateable:false,lastCreatedFormObject:{},build:function(){this.targetDiv.innerHTML="";this.isUpdateable=false;this.formObjectHolder=document.createElement("div");this.formObjectHolder.setAttribute("id","formObjectHolder");this.targetDiv.appendChild(this.formObjectHolder);this.setSaveButtonVisibility(false);var saveButtonHolder=document.getElementById("saveButtonHolder");var hook=this;saveButtonHolder.onclick=function(){var transport=hook.getData();var actionObject={command:"SaveForm",formBuilder:hook,transport:transport};hook.controller.action(actionObject);}
this.rootFormObject=new OpenPanel.GUIBuilder.GUIElements.FormObject();this.rootFormObject.setOpenCoreObject(this.openCoreObject);console.log("formbuilder",this.openCoreObject);this.rootFormObject.setParentUUID(this.parentUUID);this.rootFormObject.setTargetDiv(this.formObjectHolder);this.rootFormObject.setController(this.controller);this.rootFormObject.setFormBuilder(this);this.rootFormObject.build();},setSaveButtonVisibility:function(isVisible){var saveButtonElement=document.getElementById("saveButton");saveButtonElement.style.visibility=isVisible==true?"visible":"hidden";},finishLayout:function(formObject){if(formObject!=undefined){console.log("foo",formObject,formObject.isUpdateable);if(formObject.isUpdateable!=undefined&&formObject.isUpdateable==true){this.isUpdateable=true;this.setSaveButtonVisibility(true);}
if(formObject.parentFormObject!=undefined){this.finishLayout(formObject.parentFormObject);}}
var fH=document.getElementById('formObjectHolder');if(!isEmpty(fH))
{fH.style.height=parseInt(fH.offsetHeight)+'px';var mAF=document.getElementById('mainAreaForm');mAF.style.height=fH.style.height;}},setIsUpdateable:function(isUpdateable){this.isUpdateable=isUpdateable;},clean:function(){this.targetDiv.innerHTML="";},getData:function(){var transport=[];this.rootFormObject.getData(transport);transport.reverse();return transport;},getInstance:function(name){if(this.currentInstances[name]!=undefined){return this.currentInstances[name];}},setCurrentInstance:function(name,instanceId){this.currentInstances[name]=instanceId;},setOpenCoreObject:function(openCoreObject){this.openCoreObject=openCoreObject;},setOpenCoreParentUUID:function(parentUUID){this.parentUUID=parentUUID;},setTargetDivName:function(targetDivName){var targetDiv=document.getElementById(targetDivName);if(targetDiv!=undefined){this.targetDiv=targetDiv;}else{alert("div does not exist "+targetDivName);}},setCurrentRootClassInstance:function(currentRootClassInstance){this.currentRootClassInstance=currentRootClassInstance;},setLastCreatedFormObject:function(formObject){this.lastCreatedFormObject=formObject;}}
OpenPanel.GUIBuilder.GUIElements.FormFields=function(){this.targetDiv={};this.formObject={};this.instance=undefined;this.fieldsDiv={};this.openCoreObject={};this.openCoreInstance={};this.controller={};this.fieldValues={};this.callBackCommand="";this.formPanel={};this.ZIndex=0;this.isCreate=false;this.formItems={};this.items=[];this.itemCount=0;}
OpenPanel.GUIBuilder.GUIElements.FormFields.prototype={build:function(){this.itemCount=0;if(this.targetDiv!=undefined){this.targetDiv.innerHTML="";this.fieldsDiv=document.createElement("div");this.fieldsDiv.setAttribute("class","fields");this.targetDiv.appendChild(this.fieldsDiv);this.createFields(this.instance);}},createItem:function(fieldName,obj){if(obj.type!=undefined){var fieldType=obj.type;var item={};switch(fieldType){case"integer":case"string":item=this.createTextField(fieldName,obj);break;case"password":item=this.createTextField(fieldName,obj);item.inputType="password";break;case"enum":item=this.createEnum(fieldName,obj);break;case"bool":item=this.createBooleanField(fieldName,obj);break;case"group":item=this.createGroup(fieldName,obj);break;case"ref":item=this.createReference(fieldName,obj);break;default:item=undefined;break;}
if(item!=undefined){if(obj.group!=undefined){if(this.instance[fieldName]!=undefined){item.disabled=false;}else{item.disabled=true;}}
if(obj.visible==false){item.type="hidden";}
if(obj.required==true){if(fieldType=="password"){if(this.isCreate==true){item.allowBlank=false;}}else{item.allowBlank=false;}}
if(obj.regexp!=undefined&&obj.regexp!=""){}
return item;}}},createGroup:function(fieldName,obj){var hook=this;var grouped={};for(var paramName in this.openCoreObject.classInfo.structure.parameters){var parameter=this.openCoreObject.classInfo.structure.parameters[paramName];if(parameter.group==fieldName){grouped[paramName]=parameter;}}
var radios=[];for(var paramName in grouped){if(this.instance[paramName]!=undefined){checked=true;}else{checked=false;}
var radio={checked:checked,value:1,boxLabel:paramName,listeners:{'check':function(r,c){var foundStuff=hook.formPanel.find("name",this.boxLabel);if(c==true){for(var i=0;i<foundStuff.length;i++){foundStuff[i].enable();foundStuff[i].setVisible(true);}}else{for(var i=0;i<foundStuff.length;i++){foundStuff[i].disable();foundStuff[i].setVisible(true);}}}}}
radios.push(radio);}
var item={xtype:'ux-radiogroup',fieldLabel:fieldName,name:fieldName,horizontal:false,radios:radios};return item;},createBooleanField:function(fieldName,obj){var item={xtype:'checkbox',fieldLabel:obj.description,name:fieldName,inputValue:"true"};return item;},createNumberField:function(fieldName,obj){var item={xtype:'numberfield',fieldLabel:obj.description,name:fieldName};return item;},createEnum:function(fieldName,obj){console.log("createEnum",obj);var item={};var enumItems=[];if(this.openCoreObject.classInfo.enums[fieldName]!=undefined){var enums=this.openCoreObject.classInfo.enums[fieldName];for(var enumName in enums){var enumField=[enumName,enums[enumName].description];enumItems.push(enumField);}}
var store=new Ext.data.SimpleStore({fields:['value','description'],data:enumItems});var comboWithTooltip=new Ext.form.ComboBox({store:store,displayField:"description",valueField:"value",hiddenName:fieldName,fieldLabel:obj.description,typeAhead:true,mode:'local',triggerAction:'all',emptyText:'Select ...',selectOnFocus:true,name:fieldName,forceSelection:true,cls:"foo"});return comboWithTooltip;},createChildUsersPullDown:function(fieldName){var userOpenCoreObject=this.formObject.controller.dataManager.getOpenCoreObjectByName("User");userOpenCoreObject.setHasFetchedInstances(false);var instances=userOpenCoreObject.getInstances();var item={};var userItems=[];if(instances!=undefined){for(var userName in instances){var userField=[userName,instances[userName].uuid];userItems.push(userField);}}
var store=new Ext.data.SimpleStore({fields:['metaid','owner'],data:userItems});var comboWithTooltip=new Ext.form.ComboBox({store:store,displayField:'metaid',fieldLabel:"User",typeAhead:true,mode:'local',triggerAction:'all',emptyText:'Select ...',selectOnFocus:true,name:fieldName,forceSelection:true,value:this.formObject.controller.currentUser});return comboWithTooltip;},createReference:function(fieldName,obj){var item={};var referenceFields=[];var references=this.formObject.controller.dataManager.getReferences(obj.refclass+"/"+obj.reflabel);if(references!=undefined){for(var referenceName in references){var referenceField=[referenceName,references[referenceName]];referenceFields.push(referenceField);}}
var store=new Ext.data.SimpleStore({fields:["description","metaid"],data:referenceFields});var comboWithTooltip=new Ext.form.ComboBox({store:store,displayField:'description',fieldLabel:obj.description,valueField:'metaid',typeAhead:true,mode:'local',triggerAction:'all',emptyText:'Select ...',selectOnFocus:true,name:fieldName,forceSelection:true});return comboWithTooltip;},createTextField:function(fieldName,obj){var item={xtype:'textfield',fieldLabel:obj.description,name:fieldName};return item;},createFields:function(instance){if(instance==undefined){instance={};}
if(this.openCoreObject!=undefined&&this.openCoreObject.classInfo!=undefined&&this.openCoreObject.classInfo.structure!=undefined&&this.openCoreObject.classInfo.structure.parameters!=undefined){this.createFormPanel(instance);var fieldContainerGroup=window.OpenPanel.GUIBuilder.drawGroup();var groupHolder=fieldContainerGroup.groupHolder;var contentDiv=fieldContainerGroup.contentDiv;this.fieldsDiv.appendChild(groupHolder);this.formPanel.render(contentDiv);if(this.openCoreObject.canUpdate==false){}
var parameters=this.openCoreObject.classInfo.structure.parameters;for(var key in parameters){var parameter=parameters[key];if(parameter.visible==false){this.formPanel.items.each(function(item){console.log("ITEM",item);});}}}else{if(this.openCoreObject.singleton==true){}else{}}},createFormPanel:function(instance){var parameters=this.openCoreObject.classInfo.structure.parameters;var itemsLeft=[];var itemsRight=[];var a=0;this.fieldValues={};var hook=this;this.items={};for(var key in parameters){var parameter=parameters[key];var fieldName=key;var description=parameter.description;var fieldType=parameter.type;var item=this.createItem(fieldName,parameter);if(item!=undefined){if(this.isCreate!=true){if(this.openCoreObject.canUpdate==false||parameter.enabled==false){item.disabled=true;item.disabledClass="disabledField";}
if(fieldName=="id"){item.disabled=true;item.disabledClass="disabledField";}}
if(instance[fieldName]!=undefined){switch(parameter.type){case"bool":if(instance[fieldName]=="true"||instance[fieldName]==true){item.checked=true;}else{item.checked=false;}
break;case"ref":var referenceObject=this.formObject.controller.dataManager.getOpenCoreObjectByName(parameter.refclass);if(referenceObject!=undefined){var referenceInstances=referenceObject.getInstances();for(var metaid in referenceInstances){var referenceInstance=referenceInstances[metaid];if(referenceInstance.uuid==instance[fieldName]){item.value=metaid;}}}
break;default:item.value=instance[fieldName];break;}}
if(this.ZIndex!=0){}
this.itemCount++;this.items[fieldName]=item;console.log("item",item);}}
if(this.isCreate==true){if(this.openCoreObject.isRootObject){var item=this.createChildUsersPullDown("owner");item.value=this.formObject.controller.currentUser;this.items["owner"]=item;}
if(this.openCoreObject.classInfo["class"].parentrealm!=undefined){}}
for(var key in this.items){console.log(key,this.items[key]);}
var m=Math.ceil(this.itemCount/2);var i=0;for(var key in this.items){if(i<m){itemsLeft.push(this.items[key]);}else{itemsRight.push(this.items[key]);}
i++;}
var formItems;if(itemsRight.length==0){formItems=itemsLeft;}else{formItems=[{layout:'column',items:[{columnWidth:.5,layout:'form',items:itemsLeft},{columnWidth:.5,layout:'form',items:itemsRight}]}]}
var buttons={};if(this.callBackCommand!=""){buttons=[{text:'Save',handler:function(){hook.formPanel.submit();},formBind:true,align:"right"},{text:'Cancel',handler:function(){hook={};OpenPanel.GUIBuilder.deletePopUp();},formBind:true}]}
this.formPanel=new Ext.FormPanel({header:false,frame:false,hideBorders:true,autoScroll:true,title:'Simple Form',bodyStyle:'padding:5px 5px 5px 5px;',width:600,buttonAlign:"right",submit:function(){var obj=this.getForm().getValues();var objectId=hook.openCoreObject.singleton==true?hook.openCoreObject.classInfo["class"].singleton:obj.id;if(hook.callBackCommand!=undefined){hook.formObject.controller.action({command:hook.callBackCommand,openCoreObject:hook.openCoreObject,instance:instance,formValues:hook.parseValues(this),optionalCallBackObject:hook.optionalCallBackObject});}},items:formItems,buttons:buttons});},setZIndex:function(zIndex){this.ZIndex=zIndex;},getFormValues:function(){return this.parseValues(this.formPanel);},parseValues:function(form){console.log("parseValues");if(form!=undefined&&form.getForm!=undefined){var r=form.getForm().getValues();if(this.openCoreObject.classInfo.structure!=undefined&&this.openCoreObject.classInfo.structure.parameters!=undefined){var parameters=this.openCoreObject.classInfo.structure.parameters;for(var fieldName in parameters){var field=parameters[fieldName];console.log(field);if(field.type=="bool"){if(r[fieldName]==undefined){r[fieldName]="false";}}}}
console.log("r",r);return r;}},setInstance:function(instance){this.instance=instance;},getInstance:function(){return this.instance;},setOpenCoreObject:function(openCoreObject){this.openCoreObject=openCoreObject;},setOpenCoreInstance:function(openCoreInstance){this.openCoreInstance=openCoreInstance;},setTargetDivName:function(targetDivName){var targetDiv=document.getElementById(targetDivName);this.setTargetDiv(targetDiv);},setTargetDiv:function(targetDiv){if(targetDiv!=undefined){this.targetDiv=targetDiv;}else{alert("div does not exist "+targetDivName);}},setFormObject:function(formObject){this.formObject=formObject;},setController:function(controller){this.controller=controller;},setCallBackCommand:function(callBackCommand,optionalCallBackObject){this.callBackCommand=callBackCommand;this.optionalCallBackObject=optionalCallBackObject;},setIsCreate:function(bool){this.isCreate=bool;}}
OpenPanel.GUIBuilder.GUIElements.FormGrid=function(){this.targetDiv={};this.formObject={};this.instances={};this.openCoreObject={};this.instance={};this.controller={};this.callBackCommand="";this.store={};this.gridWidth=610;}
OpenPanel.GUIBuilder.GUIElements.FormGrid.prototype={build:function(){if(this.targetDiv!=undefined){this.targetDiv.innerHTML="";this.gridDiv=document.createElement("div");this.gridDiv.setAttribute("class","grid");this.targetDiv.appendChild(this.gridDiv);if(this.openCoreObject.meta==true){this.createMetaGrid(this.instances);}else{this.createGrid(this.instances);}
this.grid.render(this.targetDiv);if(this.instance.uuid!=undefined){var uuid=this.instance.uuid;var record=this.store.getAt(this.store.find("uuid",uuid));this.grid.getSelectionModel().selectRecords([record]);console.log("record",record);}
var hook=this;this.grid.on("cellclick",function(grid,rowIndex,columnIndex,e){hook.cellClick(hook.grid,rowIndex,columnIndex,e);});}},createMetaGrid:function(instances){var hook=this;var storeData=new Array();var instanceKeys=new Array();for(var key in instances){var instance=instances[key];if(typeof(instance)=="object"){var className=instance["class"];var classInfo=this.formObject.controller.dataManager.getClassInfo(this.openCoreObject.name);var params=classInfo.structure.parameters;var storeDataEntry=new Array();storeDataEntry.push(instance.uuid);for(var paramKey in params){var param=params[paramKey];if(param.gridhide==undefined){storeDataEntry.push(instance[paramKey]);}}
storeData.push(storeDataEntry);}}
var fields=[{name:"uuid"}];var obj={id:"uuid",header:"uuid",sortable:true,hidden:true};var columns=new Array();columns.push(obj);var className=this.openCoreObject.name;var classInfo=this.formObject.controller.dataManager.getClassInfo(className);var params=classInfo.structure.parameters;for(var paramName in params){var param=params[paramName];if(param.gridhide==undefined){fields.push({name:paramName});var obj={id:paramName,header:paramName,sortable:true};if(param.visible==false||paramName=="uuid"){obj.hidden=true;}
if(param.gridwidth!=undefined){obj.width=(this.gridWidth-10)*param.gridwidth/100;}
columns.push(obj);}}
this.store=new Ext.data.SimpleStore({fields:fields});this.store.loadData(storeData);this.grid=new Ext.grid.GridPanel({store:this.store,columns:columns,stripeRows:false,autoExpandColumn:'id',height:150,width:this.gridWidth,title:this.openCoreObject.title,header:false,sm:new Ext.grid.RowSelectionModel({singleSelect:true})});},createGrid:function(instances){var storeData=new Array();var instanceKeys=new Array();for(var key in instances){var instance=instances[key];if(typeof(instance)=="object"){var className=instance["class"];var classInfo=this.formObject.controller.dataManager.getClassInfo(className);var params=classInfo.structure.parameters;var storeDataEntry=[instance.uuid];for(var paramKey in params){var param=params[paramKey];if(param.gridhide==undefined){storeDataEntry.push(instance[paramKey]);}}
storeData.push(storeDataEntry);}}
var fields=[{name:"uuid"}];var columns=[{id:"uuid",header:"uuid",sortable:true,hidden:true}];var className=this.openCoreObject.name;var classInfo=this.formObject.controller.dataManager.getClassInfo(className);var params=classInfo.structure.parameters;for(var paramName in params){var param=params[paramName];if(param.gridhide==undefined){fields.push({name:paramName});var obj={id:paramName,header:paramName,sortable:true};if(param.visible==false){obj.hidden=true;}
if(param.gridwidth!=undefined){obj.width=(this.gridWidth-10)*param.gridwidth/100;}
columns.push(obj);}}
this.store=new Ext.data.SimpleStore({fields:fields});this.store.loadData(storeData);this.grid=new Ext.grid.GridPanel({store:this.store,columns:columns,stripeRows:false,autoExpandColumn:fields[0].name,height:150,width:this.gridWidth,title:this.openCoreObject.title,header:false});},cellClick:function(grid,rowIndex,columnIndex,e){var record=this.store.getAt(rowIndex);var fieldName=this.grid.getColumnModel().getDataIndex(columnIndex);var id=record.get("id");if(id==undefined){id=record.get("uuid");}
this.clickGridItem(id);},clickGridItem:function(id){console.log("clickGridItem",id,this.instances);this.formObject.clickGridItem(this.instances[id]);},setInstances:function(instances){this.instances=instances;},setOpenCoreObject:function(openCoreObject){this.openCoreObject=openCoreObject;},setInstance:function(instance){this.instance=instance;},setTargetDivName:function(targetDivName){var targetDiv=document.getElementById(targetDivName);this.setTargetDiv(targetDiv);},setTargetDiv:function(targetDiv){if(targetDiv!=undefined){this.targetDiv=targetDiv;}else{alert("div does not exist "+targetDivName);}},setFormObject:function(formObject){this.formObject=formObject;},setController:function(controller){this.controller=controller;},setCallBackCommand:function(callBackCommand,optionalCallBackObject){this.callBackCommand=callBackCommand;this.optionalCallBackObject=optionalCallBackObject;}}
OpenPanel.GUIBuilder.GUIElements.FormObject=function(){this.guiBuilder;this.formBuilder;this.controller;this.isBuilt;this.parentFormObject=666;this.openCoreObject;this.parentUUID="";this.instances=[];this.currentInstance;this.currentMetaInstance;this.grid;this.fields;this.targetDiv;this.gridDiv;this.fieldsDiv;this.methodsDiv;this.buttonsDiv;this.childFormObjectsDiv;this.isUpdateable=false;this.childFormObjects=[];}
OpenPanel.GUIBuilder.GUIElements.FormObject.setGuiBuilder=function(guiBuilder){this.guiBuilder=guiBuilder;}
OpenPanel.GUIBuilder.GUIElements.FormObject.prototype={build:function(){if(this.openCoreObject!=undefined){this.init();this.targetDiv.innerHTML="";this.createDivs();if(this.openCoreObject.classInfo==undefined||(this.openCoreObject.classInfo!=undefined&&this.openCoreObject.classInfo.info==undefined)||(this.openCoreObject.classInfo.info!=undefined&&this.openCoreObject.classInfo.info.parent==undefined)){this.createTopLevelForm();}else{this.createSubLevelFormAsync();}}
this.isBuilt=true;},init:function(){this.childFormObjects={};},createDivs:function(){var nameDiv=document.createElement("div");nameDiv.innerHTML=this.openCoreObject.title;nameDiv.setAttribute("class","nameDiv");this.targetDiv.appendChild(nameDiv);this.gridDiv=document.createElement("div");this.gridDiv.setAttribute("id",this.openCoreObject.name+":grid");this.gridDiv.setAttribute("class","formGrid");this.targetDiv.appendChild(this.gridDiv);this.fieldsDiv=document.createElement("div");this.fieldsDiv.setAttribute("id",this.openCoreObject.name+":fields");this.fieldsDiv.setAttribute("class","formFields");this.targetDiv.appendChild(this.fieldsDiv);var anchorDiv=document.createElement("a");anchorDiv.setAttribute("name",this.openCoreObject.name);this.targetDiv.appendChild(anchorDiv);this.childFormObjectsDiv=document.createElement("div");this.childFormObjectsDiv.setAttribute("id",this.openCoreObject.name+":childFormObjects");this.childFormObjectsDiv.setAttribute("class","childFormObjects");this.targetDiv.appendChild(this.childFormObjectsDiv);},createTopLevelForm:function(){console.log("FormObject:createTopLevelForm");this.setCurrentInstance(this.controller.currentRootClassInstance);if(this.currentInstance!=undefined){console.log("there is an instance");if(this.isBuilt==true){var record=this.controller.dataManager.getRecord(this.openCoreObject.name,this.currentInstance.id);this.currentInstance=record[this.openCoreObject.name];this.openCoreObject.instances[this.currentInstance.id]=this.currentInstance;this.controller.currentRootClassInstance=this.currentInstance;console.log("asdasd",record,this.currentInstance,this.openCoreObject.instances);}
if(this.openCoreObject.canUpdate==true){this.setIsUpdateable(true);console.log("can update");var targetDiv;if(this.openCoreObject.singleton==true&&this.openCoreObject.canDelete==true){console.log("is singleton and can delete");targetDiv=document.createElement("div");targetDiv.setAttribute("style","border: 1px solid #F00");targetDiv.appendChild(document.createTextNode("delete this object?"));this.fieldsDiv.appendChild(targetDiv);}else{console.log("not singleton or can not delete");targetDiv=this.fieldsDiv;}
console.log("create fields for "+this.openCoreObject.name+"  "+this.currentInstance.id);console.log(this.currentInstance);}else{console.log("can not update");if(this.openCoreObject.singleton==true&&this.openCoreObject.canDelete==true){console.log("is singleton and can delete");targetDiv=document.createElement("div");targetDiv.setAttribute("style","border: 1px solid #F00");targetDiv.appendChild(document.createTextNode("delete this object?"));this.fieldsDiv.appendChild(targetDiv);}else{console.log("not singleton or can not delete");targetDiv=this.fieldsDiv;}}
this.createFields(this.openCoreObject,this.currentInstance,"",targetDiv);this.createMethods(this.openCoreObject);if(this.openCoreObject.canDelete==true){if(this.openCoreObject.singleton==true){}}else{}}else{if(this.openCoreObject.canCreate==true){this.createCreateOption(true);}}
this.formBuilder.setIsUpdateable(false);this.formBuilder.finishLayout(this);},createSubLevelFormAsync:function createSubLevelFormAsync(stateObject){var state;var passThrough;if(stateObject!=undefined){if(stateObject.state!=undefined){state=stateObject.state;}
if(stateObject.passThrough!=undefined){passThrough=stateObject.data;}}
switch(state){case undefined:this.openCoreObject.setHasFetchedInstances(false);this.openCoreObject.getInstancesByParentUUIDAsync(this.parentUUID,this,"createSubLevelFormAsync",{state:"getInstancesByParentUUIDDone"});break;case"getInstancesByParentUUIDDone":this.instances=this.openCoreObject.instances;if(this.instances!=undefined&&typeof(this.openCoreObject.getFirstInstance())=="object"){var instance=this.getPreviousInstance();if(instance!=undefined){this.setCurrentInstance(instance);}else{this.setCurrentInstance(this.openCoreObject.getFirstInstance());}
var actualOpenCoreObject;var actualInstance;console.log("currentInstance "+this.currentInstance);var className=this.currentInstance["class"];if(this.openCoreObject.name!=className){actualOpenCoreObject=this.controller.dataManager.getOpenCoreObjectByName(className);var record=this.controller.dataManager.getRecord(actualOpenCoreObject.name,this.currentInstance.id);for(var key in record){this.currentMetaInstance=record[key];break;}
actualInstance=this.currentMetaInstance;}else{actualOpenCoreObject=this.openCoreObject;actualInstance=this.currentInstance;}
if(actualOpenCoreObject.canUpdate==true){this.setIsUpdateable(true);}
console.log("actualOpenCoreObject",actualOpenCoreObject.name);this.createFields(actualOpenCoreObject,actualInstance,"",this.fieldsDiv);this.createMethods(actualOpenCoreObject);if(actualOpenCoreObject.singleton==true){console.log("singleton");this.createCreateOption(false,true);this.createDeleteOption();}else{console.log("not singleton");console.log("create Grid for "+this.openCoreObject.name);console.log(this.instances);this.createGrid(this.openCoreObject,this.instances,"callBackCommand",this.gridDiv,{},this.currentInstance);this.childFormObjects=[];for(var childOpenCoreObjectName in actualOpenCoreObject.children){var childOpenCoreObject=actualOpenCoreObject.children[childOpenCoreObjectName];if(typeof(childOpenCoreObject)=="object"){console.log(childOpenCoreObject);if(childOpenCoreObject.classInfo["class"].metabase==""){var someDiv=document.createElement("div");this.childFormObjectsDiv.appendChild(someDiv);if(typeof(childOpenCoreObject)=="object"){this.createChildFormObject(childOpenCoreObject,actualInstance.uuid,someDiv,this.controller);}}}}
if(this.openCoreObject.meta==true){this.createMultiCreateOption();}else{if(this.openCoreObject.canCreate==true){this.createCreateOption(false);}}
if(this.openCoreObject.meta==true){this.createDeleteOption();}else{if(this.openCoreObject.canDelete==true){this.createDeleteOption();}}
if(OpenPanel.GUIBuilder.getLastAnchor()==this.openCoreObject.name){OpenPanel.GUIBuilder.goToLastAnchor();}}}else{console.log("no instances");var msg="No configured "+this.openCoreObject.title+" objects found. ";var pElement=document.createElement("p");this.gridDiv.appendChild(document.createTextNode(msg));if(this.openCoreObject.meta==true){this.createMultiCreateOption(true);}else{if(this.openCoreObject.canCreate==true){this.createCreateOption(true);}}}
this.formBuilder.setIsUpdateable(false);this.formBuilder.finishLayout(this);break;}},setIsUpdateable:function(isUpdateable){this.isUpdateable=isUpdateable;console.log("setIsUpdateable",this.isUpdateable,this.openCoreObject.name);},createMultiCreateOption:function(){var metaObjects=this.controller.dataManager.getOpenCoreObjectsByMetaName(this.openCoreObject.name);var available={};var canAdd=false;console.log(metaObjects);var canAdds={};for(var i=0;i<metaObjects.length;i++){var metaObject=metaObjects[i];canAdds[metaObject.name]=this.controller.dataManager.checkQuotum(metaObject.name);if(this.controller.dataManager.checkQuotum(metaObject.name)){available[metaObject.name]=metaObject;canAdd=true;}}
if(canAdd==true){var createOne=document.createElement("span");var hook=this;this.gridDiv.appendChild(createOne);var s=document.createElement("select");var optionElement=document.createElement("option");optionElement.appendChild(document.createTextNode("select..."));s.appendChild(optionElement);s.onchange=function(){console.log(this);for(var i=0;i<this.options.length;i++){var option=this.options[i];if(option.value==this.value){var openCoreObject=option.openCoreObject;}}
if(openCoreObject!=undefined){hook.controller.action({command:"ShowCreateInstanceFromFormObjectMeta",formObject:hook,openCoreObject:openCoreObject,parentUUID:hook.parentUUID,formObjectHolder:hook.formBuilder.formObjectHolder});}}
for(var key in available){var metaObject=available[key];var optionElement=document.createElement("option");optionElement.value=key;optionElement.appendChild(document.createTextNode(key));optionElement.openCoreObject=metaObject;s.appendChild(optionElement);}
createOne.appendChild(s);var q=document.createElement("ul");for(var key in canAdds){var quotum=this.controller.dataManager.getQuotumByClassName(key);if(quotum!=undefined){var li=document.createElement("li");li.appendChild(document.createTextNode(">>quotum : "+key+" "+quotum.quota));q.appendChild(li);}}}},createCreateOption:function(textOnly,displayOnly){if(this.openCoreObject.meta==true){}else{if(this.controller.dataManager.checkQuotum(this.openCoreObject.name)==true){var createOne=document.createElement("span");if(textOnly==true){createOne.innerHTML="<b>Click here to create one.</b>";createOne.setAttribute("class","createOneSpan");}else{var addButton=document.createElement("div");var addButtonClass=displayOnly==true?"addButtonDisabled":"addButton";addButton.setAttribute("class",addButtonClass);createOne.appendChild(addButton);}
var hook=this;createOne.openCoreObject=this.openCoreObject;if(displayOnly==undefined||displayOnly==false){createOne.onclick=function(){hook.controller.action({command:"ShowCreateInstanceFromFormObject",formObject:hook,openCoreObject:hook.openCoreObject,parentUUID:hook.parentUUID,formObjectHolder:hook.formBuilder.formObjectHolder});console.log("create Instance of "+hook.openCoreObject.name+" with parentUUID "+hook.parentUUID);console.log(hook);console.log(hook.formBuilder.formObjectHolder);}}
q=document.createElement("ul");createOne.appendChild(q);this.gridDiv.appendChild(createOne);if(textOnly==true){if(this.openCoreObject.classInfo["class"].explanation!=undefined){var explanationElement=document.createElement("div");createOne.appendChild(explanationElement);explanationElement.innerHTML="<br>"+this.openCoreObject.classInfo["class"].explanation;this.gridDiv.appendChild(explanationElement);}}}}},createDeleteOption:function(){var deleteOne=document.createElement("span");var deleteButton=document.createElement("div");deleteButton.setAttribute("class","deleteButton");deleteOne.appendChild(deleteButton);var hook=this;deleteOne.openCoreObject=this.openCoreObject;deleteOne.onclick=function(){hook.controller.action({command:"ShowDeleteInstanceFromFormObject",formObject:hook,openCoreObject:hook.openCoreObject,parentUUID:hook.parentUUID,formObjectHolder:hook.formBuilder.formObjectHolder});console.log("delete Instance of "+hook.openCoreObject.name+" with parentUUID "+hook.parentUUID);}
this.gridDiv.appendChild(deleteOne);},getPreviousInstance:function(){var previousInstanceName=this.formBuilder.getInstance(this.openCoreObject.name);var previousInstance=this.instances[previousInstanceName];if(previousInstance!=undefined){return previousInstance;}},setCurrentInstance:function(instance){if(instance!=undefined){this.currentInstance=instance;this.openCoreObject.setCurrentInstance(instance);this.formBuilder.setCurrentInstance(this.openCoreObject.name,instance.id);}},getData:function(transport){console.log("getData "+this.openCoreObject.name);var actualOpenCoreObject;var actualInstance;if(this.openCoreObject.meta==true){actualOpenCoreObject=this.controller.dataManager.getOpenCoreObjectByName(this.currentMetaInstance["class"]);actualInstance=this.currentMetaInstance;}else{actualOpenCoreObject=this.openCoreObject;actualInstance=this.currentInstance;}
if(actualOpenCoreObject.canUpdate==true){console.log("hi");var formData=this.getFormData();if(formData!=undefined){console.log(formData);transport.push({openCoreObject:actualOpenCoreObject,formData:formData,instance:actualInstance})}}
for(var key in this.childFormObjects){var childFormObject=this.childFormObjects[key];if(typeof(childFormObject)=="object"){console.log("childFormObject",childFormObject);console.log("child: "+childFormObject.openCoreObject.name);childFormObject.getData(transport);}}},getFormData:function(){if(this.fields!=undefined&&this.fields.getFormValues!=undefined){var r=this.fields.getFormValues();return r;}},createFields:function(openCoreObject,instance,callBackCommand,targetDiv,optionalCallBackObject){this.fields=new OpenPanel.GUIBuilder.GUIElements.FormFields();this.fields.setTargetDiv(targetDiv);this.fields.setOpenCoreObject(openCoreObject);this.fields.setFormObject(this);this.fields.setInstance(instance);if(optionalCallBackObject==undefined){optionalCallBackObject={};}
this.fields.setCallBackCommand(callBackCommand,optionalCallBackObject);this.fields.build();},createMethods:function(openCoreObject){if(openCoreObject.classInfo.structure.methods!=""){this.methodsDiv=document.createElement("div");this.methodsDiv.setAttribute("id",this.openCoreObject.name+":methods");this.methodsDiv.setAttribute("id","methods");this.targetDiv.appendChild(this.methodsDiv);var fieldContainerGroup=window.OpenPanel.GUIBuilder.drawGroup();var groupHolder=fieldContainerGroup.groupHolder;var contentDiv=fieldContainerGroup.contentDiv;this.methodsDiv.appendChild(groupHolder);var methods=openCoreObject.classInfo.structure.methods;var items=[];var hook=this;for(var key in methods){var method=methods[key];if(typeof(method)=="object"){var item={html:method.description,style:"width: 100%;"};var button={xtype:"button",text:"Ok",style:"width: 100%;",foo:100,handler:function(){hook.controller.action({command:"InvokeMethod",openCoreObject:openCoreObject,methodName:key});}}
items.push(item);items.push(button);}}
var table=new Ext.Panel({layout:'table',style:"width: 600px;",defaults:{bodyStyle:'padding-right:20px; margin-top: 10px;margin-bottom: 10px'},layoutConfig:{columns:2},items:items});table.render(contentDiv);}},createModalFields:function(openCoreObject,instance,callBackCommand,targetDiv,optionalCallBackObject){this.fields=new OpenPanel.GUIBuilder.GUIElements.FormFields();this.fields.setTargetDiv(targetDiv);this.fields.setOpenCoreObject(openCoreObject);this.fields.setFormObject(this);this.fields.setInstance(instance);this.fields.setIsCreate(true);this.fields.setZIndex(10000);if(optionalCallBackObject==undefined){optionalCallBackObject={};}
this.fields.setCallBackCommand(callBackCommand,optionalCallBackObject);this.fields.build();},createGrid:function(openCoreObject,instances,callBackCommand,targetDiv,optionalCallBackObject,instance){this.grid=new OpenPanel.GUIBuilder.GUIElements.FormGrid();this.grid.setTargetDiv(targetDiv);this.grid.setOpenCoreObject(openCoreObject);this.grid.setFormObject(this);this.grid.setInstances(instances);this.grid.setInstance(instance);if(optionalCallBackObject==undefined){optionalCallBackObject={};}
this.grid.setCallBackCommand(callBackCommand,optionalCallBackObject);this.grid.build();},clickGridItem:function(instance){console.log("FormObject.clickGridItem",instance);this.controller.action({command:"ClickGridItem",formObject:this,instance:instance})},createChildFormObject:function(openCoreObject,parentUUID,targetDiv,controller){var childFormObject=new OpenPanel.GUIBuilder.GUIElements.FormObject();this.childFormObjects.push(childFormObject);childFormObject.setOpenCoreObject(openCoreObject);childFormObject.setParentFormObject(this);childFormObject.setParentUUID(parentUUID);childFormObject.setTargetDiv(targetDiv);childFormObject.setController(controller);childFormObject.setFormBuilder(this.formBuilder);childFormObject.build();this.childFormObjects[openCoreObject.name]=childFormObject;},setOpenCoreObject:function(openCoreObject){this.openCoreObject=openCoreObject;console.log("setOpenCoreObject");console.log(openCoreObject);},setParentUUID:function(parentUUID){this.parentUUID=parentUUID;},setTargetDiv:function(targetDiv){this.targetDiv=targetDiv;},setController:function(controller){this.controller=controller;},setFormBuilder:function(formBuilder){this.formBuilder=formBuilder;this.formBuilder.setLastCreatedFormObject(this);},updateInstance:function(openCoreObject,instance,formData){console.log(this.openCoreObject.name);console.log(formData);},createCreatePopUp:function(targetDiv,callBack){var popUpDiv=this.guiBuilder.createPopUp();},setParentFormObject:function(foo){this.parentFormObject=foo;}}
OpenPanel.GUIBuilder.GUIElements.IconBar={targetDiv:{},openCoreObject:{},itemElements:{},controller:{},iconBarTitleElement:{},build:function(){this.targetDiv.innerHTML="";this.itemElements={};if(this.openCoreObject!=undefined){var iconBarDiv=document.createElement("div");iconBarDiv.setAttribute("class","iconBarDiv");this.iconBarTitleElement=document.createElement("div");this.iconBarTitleElement.setAttribute("class","iconBarTitle");this.iconBarTitleElement.appendChild(document.createTextNode(""));iconBarDiv.appendChild(this.iconBarTitleElement);var iconHolderTable=document.createElement("table");iconHolderTable.setAttribute("cellpadding","0");iconHolderTable.setAttribute("cellspacing","0");iconHolderTable.setAttribute("class","iconHolder");iconBarDiv.appendChild(iconHolderTable);var iconHolderTBody=document.createElement("tbody");iconHolderTable.appendChild(iconHolderTBody);var iconHolder=document.createElement("tr");iconHolder.setAttribute("class","iconHolder");this.targetDiv.appendChild(iconBarDiv);iconHolderTBody.appendChild(iconHolder);var sortIndexes={};var sortIndexesToSort=[];for(var key in this.openCoreObject.children){var childObject=this.openCoreObject.children[key];if(typeof(childObject)=="object"){var sortIndex=childObject.classInfo["class"].sortindex;if(sortIndexes[sortIndex]==undefined){sortIndexes[sortIndex]=[];}
sortIndexes[sortIndex].push(childObject);sortIndexesToSort.push(sortIndex);}}
sortIndexesToSort.sort(function(a,b){return a-b;});var sortedChildren={};sortedChildren["welcome"]={description:"Welcome",classInfo:{"class":{uuid:"crow"}},title:"Welcome",name:"Welcome",onclick:function()
{hook.controller.action({command:"Welcome"});}};for(var i=0;i<sortIndexesToSort.length;i++){var childObjects=sortIndexes[sortIndexesToSort[i]];for(var j=0;j<childObjects.length;j++){sortedChildren[childObjects[j].name]=childObjects[j];}}
var hook=this;sortedChildren["spacer"]={};sortedChildren["exit"]={description:"Exit",classInfo:{"class":{uuid:"exit"}},title:"Exit",name:"name",onclick:function()
{hook.controller.action({command:"Logout"});}};for(var key in sortedChildren){var childObject=sortedChildren[key];if(typeof(childObject)=="object"){if(key!="spacer"){var iconLi=document.createElement("td");iconHolder.appendChild(iconLi);iconLi.setAttribute("id",childObject.description);iconLi.setAttribute("valign","top");var tableElement=document.createElement("table");tableElement.setAttribute("cellpadding","0");tableElement.setAttribute("cellspacing","0");tableElement.setAttribute("class","iconTable");iconLi.appendChild(tableElement);var tbodyElement=document.createElement("tbody");tableElement.appendChild(tbodyElement);var trElement=document.createElement("tr");tbodyElement.appendChild(trElement);var iconTdLeft=document.createElement("td");iconTdLeft.id="iconTdLeft";iconTdLeft.setAttribute("class","iconTdLeft");iconTdLeft.innerHTML="&nbsp;";trElement.appendChild(iconTdLeft);var tdMain=document.createElement("td");tdMain.id="iconTdMain";tdMain.setAttribute("class","iconTdMain");tdMain.setAttribute("valign","top");trElement.appendChild(tdMain);var cl=document.createElement("DIV");cl.id='iconbarIcon';cl.setAttribute("class","classIcon");cl.innerHTML="<img src=\"/images/icons/"+childObject.classInfo["class"].uuid+".png\"/><br\>";tdMain.appendChild(cl);var cD=document.createElement("DIV");cD.id='iconbarText';cD.setAttribute("class","classDescription");cD.innerHTML=childObject.title;tdMain.appendChild(cD);var iconTdRight=document.createElement("td");iconTdRight.id="iconTdRight";iconTdRight.setAttribute("class","iconTdRight");iconTdRight.innerHTML="&nbsp;";trElement.appendChild(iconTdRight);if(childObject.onclick==undefined){iconLi.childObject=childObject;iconLi.onclick=function(){OpenPanel.GUIBuilder.GUIElements.IconBar.click(this.childObject);}}else{iconLi.onclick=childObject.onclick;}
this.itemElements[childObject.name]=iconLi;}else{var iconLi=document.createElement("td");iconLi.setAttribute("width","100%");iconHolder.appendChild(iconLi);}}}}else{alert("OpenPanel.GUIBuilder.GUIElements.IconBar.build(openCoreObject) : openCoreObject is undefined");}},setTitle:function(title){this.iconBarTitleElement.innerHTML='';this.iconBarTitleElement.style.display="none";},click:function(childObject){this.setTitle(childObject.title);if(childObject.name!=undefined){if(this.itemElements[childObject.name]!=undefined){var currentItemElement=this.itemElements[childObject.name];this.highliteItem(childObject.name);this.controller.action({command:"ClickIconBarItem",className:childObject.name});}}},highliteItem:function(className){if(className!=undefined&&this.itemElements[className]!=undefined){var currentItemElement=this.itemElements[className];for(var key in this.itemElements){if(this.itemElements[key]==currentItemElement){this.itemElements[key].setAttribute("class","selected")
STYLES.iconBar.highliteItem(this.itemElements[key],'high');}else{this.itemElements[key].setAttribute("class","");STYLES.iconBar.highliteItem(this.itemElements[key],'low');}}}},setOpenCoreObject:function(openCoreObject){this.openCoreObject=openCoreObject;},setTargetDivName:function(targetDivName){var targetDiv=document.getElementById(targetDivName);if(targetDiv!=undefined){this.targetDiv=targetDiv;}else{alert("div does not exist "+targetDivName);}}}
OpenPanel.GUIBuilder.GUIElements.IconBar={targetDiv:{},openCoreObject:{},itemElements:{},controller:{},iconBarTitleElement:{},build:function(){this.targetDiv.innerHTML="";this.itemElements={};if(this.openCoreObject!=undefined){var iconBarDiv=document.createElement("div");iconBarDiv.setAttribute("class","iconBarDiv");this.iconBarTitleElement=document.createElement("div");this.iconBarTitleElement.setAttribute("class","iconBarTitle");this.iconBarTitleElement.appendChild(document.createTextNode(""));iconBarDiv.appendChild(this.iconBarTitleElement);var iconHolderTable=document.createElement("table");iconHolderTable.setAttribute("cellpadding","0");iconHolderTable.setAttribute("cellspacing","0");iconHolderTable.setAttribute("class","iconHolder");iconBarDiv.appendChild(iconHolderTable);var iconHolderTBody=document.createElement("tbody");iconHolderTable.appendChild(iconHolderTBody);var iconHolder=document.createElement("tr");iconHolder.setAttribute("class","iconHolder");this.targetDiv.appendChild(iconBarDiv);iconHolderTBody.appendChild(iconHolder);var sortIndexes={};var sortIndexesToSort=[];for(var key in this.openCoreObject.children){var childObject=this.openCoreObject.children[key];if(typeof(childObject)=="object"){var sortIndex=childObject.classInfo["class"].sortindex;if(sortIndexes[sortIndex]==undefined){sortIndexes[sortIndex]=[];}
sortIndexes[sortIndex].push(childObject);sortIndexesToSort.push(sortIndex);}}
sortIndexesToSort.sort(function(a,b){return a-b;});var sortedChildren={};sortedChildren["welcome"]={description:"Welcome",classInfo:{"class":{uuid:"crow"}},title:"Welcome",name:"Welcome",onclick:function()
{hook.controller.action({command:"Welcome"});}};for(var i=0;i<sortIndexesToSort.length;i++){var childObjects=sortIndexes[sortIndexesToSort[i]];for(var j=0;j<childObjects.length;j++){sortedChildren[childObjects[j].name]=childObjects[j];}}
var hook=this;sortedChildren["spacer"]={};sortedChildren["exit"]={description:"Exit",classInfo:{"class":{uuid:"exit"}},title:"Exit",name:"name",onclick:function()
{hook.controller.action({command:"Logout"});}};for(var key in sortedChildren){var childObject=sortedChildren[key];if(typeof(childObject)=="object"){if(key!="spacer"){var iconLi=document.createElement("td");iconHolder.appendChild(iconLi);iconLi.setAttribute("id",childObject.description);var tableElement=document.createElement("table");tableElement.setAttribute("cellpadding","0");tableElement.setAttribute("cellspacing","0");tableElement.setAttribute("class","iconTable");iconLi.appendChild(tableElement);var tbodyElement=document.createElement("tbody");tableElement.appendChild(tbodyElement);var trElement=document.createElement("tr");tbodyElement.appendChild(trElement);var iconTdLeft=document.createElement("td");iconTdLeft.setAttribute("class","iconTdLeft");iconTdLeft.innerHTML="&nbsp;";trElement.appendChild(iconTdLeft);var tdMain=document.createElement("td");tdMain.setAttribute("class","iconTdMain");trElement.appendChild(tdMain);var centreTable=document.createElement("table");centreTable.setAttribute("cellpadding","0");centreTable.setAttribute("cellspacing","0");tdMain.appendChild(centreTable);var centreTbody=document.createElement("tbody");centreTable.appendChild(centreTbody);var centreTr=document.createElement("tr");centreTbody.appendChild(centreTr);var centreTrBottom=document.createElement("tr");centreTbody.appendChild(centreTrBottom);var classIcon=document.createElement("td");classIcon.setAttribute("class","classIcon");classIcon.setAttribute("align","Center");var imgElement=document.createElement("img");imgElement.setAttribute("src","/images/icons/"+childObject.classInfo["class"].uuid+".png");classIcon.innerHTML="<img src=\"/images/icons/"+childObject.classInfo["class"].uuid+".png\"/>";centreTr.appendChild(classIcon);var classDescription=document.createElement("td");classDescription.setAttribute("class","classDescription");classDescription.setAttribute("valign","top");classDescription.setAttribute("noWrap","TRUE");classDescription.setAttribute("align","Center");centreTrBottom.appendChild(classDescription);var title=childObject.title;classDescription.appendChild(document.createTextNode(title));var iconTdRight=document.createElement("td");iconTdRight.setAttribute("class","iconTdRight");iconTdRight.innerHTML="&nbsp;";trElement.appendChild(iconTdRight);if(childObject.onclick==undefined){iconLi.childObject=childObject;iconLi.onclick=function(){OpenPanel.GUIBuilder.GUIElements.IconBar.click(this.childObject);}}else{iconLi.onclick=childObject.onclick;}
this.itemElements[childObject.name]=iconLi;}else{var iconLi=document.createElement("td");iconLi.setAttribute("width","100%");iconHolder.appendChild(iconLi);}}}}else{alert("OpenPanel.GUIBuilder.GUIElements.IconBar.build(openCoreObject) : openCoreObject is undefined");}},setTitle:function(title){this.iconBarTitleElement.innerHTML=title;},click:function(childObject){this.setTitle(childObject.title);if(childObject.name!=undefined){if(this.itemElements[childObject.name]!=undefined){var currentItemElement=this.itemElements[childObject.name];this.highliteItem(childObject.name);this.controller.action({command:"ClickIconBarItem",className:childObject.name});}}},highliteItem:function(className){if(className!=undefined&&this.itemElements[className]!=undefined){var currentItemElement=this.itemElements[className];for(var key in this.itemElements){if(this.itemElements[key]==currentItemElement){this.itemElements[key].setAttribute("class","selected")}else{this.itemElements[key].setAttribute("class","");}}}},setOpenCoreObject:function(openCoreObject){this.openCoreObject=openCoreObject;},setTargetDivName:function(targetDivName){var targetDiv=document.getElementById(targetDivName);if(targetDiv!=undefined){this.targetDiv=targetDiv;}else{alert("div does not exist "+targetDivName);}}}
OpenPanel.GUIBuilder.GUIElements.ItemList={targetDiv:{},openCoreObject:{},itemListElements:{},instances:{},grid:{},popUpDiv:{},gridDiv:{},buttonsDiv:{},guiBuilder:{},formObject:{},currentInstance:{},controller:{},userObject:{},build:function(){this.targetDiv.innerHTML="";this.itemListElements={};this.instances={};this.currentInstance=undefined;this.userObject=OpenCore.DataManager.getOpenCoreObjectByName("User");this.userObject.getInstances();if(this.openCoreObject!=undefined){if(this.openCoreObject.singleton==false){this.instances=this.openCoreObject.getInstances();var items=[];for(var metaid in this.instances){var instance=this.instances[metaid];if(this.currentInstance==undefined){this.currentInstance=instance;}
if(typeof(instance)=="object"){var userInstance=this.userObject.getInstanceByUUID(instance.ownerid);var ownerName=userInstance!=undefined?userInstance.name_customer:"";var item=[instance.uuid,this.openCoreObject.name,metaid,ownerName];}
items.push(item);}
this.gridDiv=document.createElement("div");this.gridDiv.setAttribute("id","itemListGrid");this.targetDiv.appendChild(this.gridDiv);this.buttonsDiv=document.createElement("div");this.buttonsDiv.setAttribute("id","itemListButtons");this.targetDiv.appendChild(this.buttonsDiv);this.renderGrid(this.gridDiv,items);this.renderButtons(this.buttonsDiv);}else{this.targetDiv.innerHTML="<center><img src=\"/images/emblems/"+this.openCoreObject.uuid+".png\"/></center>";}}else{alert("OpenPanel.GUIBuilder.GUIElements.ItemList.build(openCoreObject) : openCoreObject is undefined");}},renderButtons:function(targetDiv){if(targetDiv!=undefined&&targetDiv.parentNode!=undefined){targetDiv.innerHTML="";var addDeleteButtonHolder=document.createElement("div");addDeleteButtonHolder.setAttribute("class","addDeleteButtonHolder");targetDiv.appendChild(addDeleteButtonHolder);if(this.openCoreObject.meta==true){}else{var createButton=document.createElement("div");addDeleteButtonHolder.appendChild(createButton);if(this.controller.dataManager.checkQuotum(this.openCoreObject.name)==true&&this.openCoreObject.canCreate==true){createButton.setAttribute("class","addButton");var hook=this;createButton.onclick=function(){hook.createInstance();}}else{createButton.setAttribute("class","addButtonDisabled");}
var deleteButton=document.createElement("div");addDeleteButtonHolder.appendChild(deleteButton);var l=0;for(var key in this.instances){l=1;break;}
if(this.controller.dataManager.checkQuotum(this.openCoreObject.name)==true&&this.openCoreObject.canDelete==true&&l==1){deleteButton.setAttribute("class","deleteButton");var hook=this;deleteButton.onclick=function(){hook.deleteInstance();}}else{deleteButton.setAttribute("class","deleteButtonDisabled");}}}},createInstance:function(){this.controller.action({command:"ShowCreateInstanceFromItemList",openCoreObject:this.openCoreObject,formObjectHolder:this.formObjectHolder});this.renderButtons();},deleteInstance:function(){OpenPanel.Controller.action({command:"DeleteInstance",openCoreObject:this.openCoreObject,instance:this.currentInstance});},click:function(uuid){if(uuid!=undefined){var instance=this.openCoreObject.getInstanceByUUID(uuid);this.currentInstance=instance;for(var key in this.instances){if(this.instances[key].uuid==uuid){OpenPanel.Controller.action({command:"ClickItemListItem",className:this.openCoreObject.name,instanceUUID:uuid});this.highliteItem(uuid);break;}}}},highliteItem:function(uuid){this.renderButtons(this.buttonsDiv);},setOpenCoreObject:function(openCoreObject){this.openCoreObject=openCoreObject;},setTargetDivName:function(targetDivName){var targetDiv=document.getElementById(targetDivName);if(targetDiv!=undefined){this.targetDiv=targetDiv;}else{alert("div does not exist "+targetDivName);}},renderGrid:function(targetDiv,data){var store=new Ext.data.SimpleStore({fields:[{name:'uuid'},{name:'className'},{name:'id'},{name:'ownerid'}]});store.loadData(data);this.grid=new Ext.grid.GridPanel({store:store,columns:[{id:'uuid',header:"Uuid",width:0,sortable:true,dataIndex:'uuid',hidden:true,hideable:false,fixed:true},{header:"id",width:190,sortable:true,dataIndex:'id',hideable:false},{header:"className",width:0,sortable:true,dataIndex:'className',hidden:true,hideable:false},{header:"ownerid",width:0,sortable:true,dataIndex:'ownerid',hidden:true,hideable:true}],stripeRows:false,autoExpandColumn:'uuid',height:372,width:200,title:this.openCoreObject.description,header:false,forceFit:true});this.grid.render(targetDiv);this.grid.getSelectionModel().selectFirstRow();var hook=this;this.grid.on("cellclick",function(grid,rowIndex,columnIndex,e){hook.cellClick(this.grid,rowIndex,columnIndex,e);});},cellClick:function(grid,rowIndex,columnIndex,e){var record=this.grid.getStore().getAt(rowIndex);var fieldName=this.grid.getColumnModel().getDataIndex(columnIndex);var data=record.get("uuid");this.click(data);},setGuiBuilder:function(guiBuilder){this.guiBuilder=guiBuilder;},setFormObject:function(formObject){this.formObject=formObject;},setController:function(controller){this.controller=controller;}}
OpenPanel.GUIBuilder.GUIElements.TabBar={targetDiv:{},openCoreObject:{},itemElements:{},openCoreObjects:[],tabStart:{},tabEnd:{},tabWidth:0,build:function(){this.tabWidth=0;this.targetDiv.innerHTML="";this.itemElements={};if(this.openCoreObject!=undefined){var tabs=[];var tabDiv=document.createElement("div");tabDiv.setAttribute("id","tabBarDiv");var tabHolder=document.createElement("ul");tabHolder.setAttribute("class","tabHolder");tabHolder.setAttribute("id","tabHolder");this.targetDiv.appendChild(tabDiv);tabDiv.appendChild(tabHolder);this.tabStart=document.createElement("li");this.tabStart.setAttribute("id","tabStart");this.tabStart.setAttribute("class","tabStart");this.tabStart.innerHTML="&nbsp;";tabHolder.appendChild(this.tabStart);this.openCoreObjects=[];if(this.openCoreObject.classInfo["class"].metabase==""){if(this.openCoreObject.canUpdate==true||(this.openCoreObject.canUpdate==false&&this.openCoreObject.getParameterCount()>1)){this.openCoreObjects.push(this.openCoreObject);}}
var sortIndexes={};var sortIndexesToSort=[];for(var key in this.openCoreObject.children){this.openCoreObjects.push(this.openCoreObject.children[key]);}
for(var key in this.openCoreObjects){var childObject=this.openCoreObjects[key];if(typeof(childObject)=="object"){var sortIndex=childObject.classInfo["class"].sortindex;if(sortIndexes[sortIndex]==undefined){sortIndexes[sortIndex]=[];}
sortIndexes[sortIndex].push(childObject);sortIndexesToSort.push(sortIndex);}}
sortIndexesToSort.sort(function(a,b){return a-b;});var sortedChildren={};for(var i=0;i<sortIndexesToSort.length;i++){var childObjects=sortIndexes[sortIndexesToSort[i]];for(var j=0;j<childObjects.length;j++){sortedChildren[childObjects[j].name]=childObjects[j];}}
for(var i=0;i<this.openCoreObject.children.length;i++){var someObject=this.openCoreObject.children[i];if(typeof(someObject)=="object"){if(someObject.classInfo["class"].metabase==""){this.openCoreObjects.push(someObject);}}else{alert("OpenPanel.GUIBuilder.GUIElements.TabBar.build(openCoreObject) : openCoreObject is undefined");}}
for(var key in sortedChildren){var someObject=sortedChildren[key];if(someObject.metaType!="derived"){var tabSpan=document.createElement("li");tabSpan.setAttribute("id",someObject.uuid);tabSpan.setAttribute("OC:Class",someObject.name);tabSpan.appendChild(document.createTextNode(someObject.title));tabs.push(tabSpan);tabSpan.onclick=function(){OpenPanel.GUIBuilder.GUIElements.TabBar.click(this.getAttribute("OC:Class"))}
this.itemElements[someObject.name]=tabSpan;tabSpan.setAttribute("class","tab");STYLES.tab.tab(tabSpan);}}
for(var i=0;i<tabs.length;i++){var tabSpan=tabs[i];tabHolder.appendChild(tabSpan);if(tabs.length>1){if(i==0){var delimiter=this.createDelimiter();tabSpan.rightDelimiter=delimiter;tabHolder.appendChild(delimiter);}else if(i==tabs.length-1){tabSpan.leftDelimiter=delimiter;}else{tabSpan.leftDelimiter=delimiter;var delimiter=this.createDelimiter();tabSpan.rightDelimiter=delimiter;tabHolder.appendChild(delimiter);}}
var el=Ext.get(tabSpan.getAttribute("id"));this.tabWidth+=el.getWidth();}
if(tabs.length>0){this.tabWidth+=(tabs.length-1)*16+30;}
this.tabEnd=document.createElement("li");this.tabEnd.innerHTML="&nbsp;";this.tabEnd.setAttribute("id","tabEnd");this.tabEnd.setAttribute("class","tabEnd");STYLES.tab.tabEnd(this.tabEnd);tabHolder.appendChild(this.tabEnd);var tabDivElement=Ext.get("tabBarDiv");tabDivElement.setWidth(this.tabWidth);tabDivElement.setStyle("marginLeft",Math.round(this.tabWidth/-2)+"px");tabDivElement.setStyle("left","50%");}},createDelimiter:function(){var delimiter=document.createElement("li");delimiter.setAttribute("class","tabDelimiter");STYLES.tab.tabDelimiter(delimiter);return delimiter;},click:function(className){if(className!=undefined){if(this.itemElements[className]!=undefined){this.highliteItem(className);OpenPanel.Controller.action({command:"ClickTabBarItem",className:className});}}},highliteItem:function(className){if(className!=undefined&&this.itemElements[className]!=undefined){var currentItemElement=this.itemElements[className];var virgin=true;for(var key in this.itemElements){var someItem=this.itemElements[key];if(typeof(someItem)=="object"){if(virgin==true){virgin=false;if(someItem==currentItemElement){this.tabStart.setAttribute("class","tabStartSelected");STYLES.tab.tabStartSelected(this.tabStart);}else{this.tabStart.setAttribute("class","tabStart");STYLES.tab.tabStart(this.tabStart);}}
if(someItem==currentItemElement){someItem.setAttribute("class","tabSelected");STYLES.tab.tabSelected(someItem);}else{someItem.setAttribute("class","tab");STYLES.tab.tab(someItem);}
this.setDelimiterClass(someItem,false);}}
for(var key in this.itemElements){var someItem=this.itemElements[key];if(someItem==currentItemElement){this.setDelimiterClass(someItem,true);}}
if(someItem!=undefined){if(someItem==currentItemElement){this.tabEnd.setAttribute("class","tabEndSelected");STYLES.tab.tabEndSelected(this.tabEnd);}else{this.tabEnd.setAttribute("class","tabEnd");STYLES.tab.tabEnd(this.tabEnd);}}}},disable:function(){for(var key in this.itemElements){var tabSpan=this.itemElements[key];if(typeof(tabSpan)=="object"){tabSpan.onclick={};if(tabSpan.getAttribute("class")=="tab"){tabSpan.setAttribute("class","tabDisabled");STYLES.tab.tabDisabled(this.tabSpan);}}}},setDelimiterClass:function(tabElement,isSelected){if(tabElement.leftDelimiter!=undefined)
{if(isSelected==true)
{tabElement.leftDelimiter.setAttribute("class","tabDelimiterSelected");STYLES.tab.tabDelimiterSelected(tabElement.leftDelimiter);}
else
{tabElement.leftDelimiter.setAttribute("class","tabDelimiter");STYLES.tab.tabDelimiter(tabElement.leftDelimiter);}}
if(tabElement.rightDelimiter!=undefined)
{if(isSelected==true)
{tabElement.rightDelimiter.setAttribute("class","tabDelimiterSelected");STYLES.tab.tabDelimiterSelected(tabElement.rightDelimiter);}
else
{tabElement.rightDelimiter.setAttribute("class","tabDelimiter");STYLES.tab.tabDelimiter(tabElement.rightDelimiter);}}},setOpenCoreObject:function(openCoreObject){this.openCoreObject=openCoreObject;},setTargetDivName:function(targetDivName){var targetDiv=document.getElementById(targetDivName);if(targetDiv!=undefined){this.targetDiv=targetDiv;}else{alert("div does not exist "+targetDivName);}},getFirstTabItem:function(){for(var i=0;i<this.openCoreObjects.length;i++){if(this.openCoreObjects[i].name!=undefined){return this.openCoreObjects[i];}}}}