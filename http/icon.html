<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
  	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>OpenPanel beta</title>
	<link rel="stylesheet" type="text/css" href="js/ext-2.0/resources/css/ext-all.css">
	<link rel="stylesheet" type="text/css"  href="js/ext-2.0/resources/css/xtheme-macx.css">	
	<link rel="stylesheet" type="text/css"	href="css/openpanel.css">
	<!--[if IE]>
		<link rel="stylesheet" type="text/css"	href="css/openpanel.ie.css">
	<![endif]--> 
		<script type="text/javascript" src="js/jquery-1.2.2.js"></script>
	<script type="text/javascript" src="js/json.js"></script>
	<script type="text/javascript" src="js/ext-2.0/adapter/ext/ext-base.js"></script>
	<script type="text/javascript" src="js/ext-2.0/ext-all.js"></script>
	<script type="text/javascript" src="js/ext-2.0/build/util/KeyMap-min.js"></script>
	<script type="text/javascript" src="js/trimpath-template-1.0.38/trimpath-template-1.0.38.js"></script>
	<script type="text/javascript" src="js/radiogroup.js"></script>	
	<script type="text/javascript" src="js/OpenPanelBeta/OpenCore.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenCore.RPC.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenCore.DataManager.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenCore.DataManager.OpenCoreObject.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenCore.Debug.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/Styles.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.GUIBuilder.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.GUIBuilder.GUIElements.IconBar.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.GUIBuilder.GUIElements.ItemList.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.GUIBuilder.GUIElements.TabBar.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.GUIBuilder.GUIElements.FormBuilder.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.GUIBuilder.GUIElements.FormFields.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.GUIBuilder.GUIElements.FormGrid.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.GUIBuilder.GUIElements.FormObject.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.Controller.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.Command.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.Command.Init.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.Command.DeleteInstance.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.Command.ShowCreateInstanceFromItemList.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.Command.ShowCreateInstanceFromFormObject.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.Command.ShowCreateInstanceFromFormObjectMeta.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.Command.CreateInstanceFromFormObject.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.Command.CreateInstanceFromItemList.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.Command.ShowDeleteInstanceFromFormObject.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.Command.DeleteInstanceFromFormObject.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.Command.SaveForm.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.Command.SaveFormDone.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.Command.Login.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.Command.Logout.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.Command.Welcome.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.Command.BuildIconBar.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.Command.ClickIconBarItem.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.Command.ClickItemListItem.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.Command.ClickTabBarItem.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.Command.ClickGridItem.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/OpenPanel.Command.InvokeMethod.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/Errors.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/HTTPStatus.js"></script>
	<script type="text/javascript" src="js/OpenPanelBeta/Throbber.js"></script>
	<script type="text/javascript">
		var $j = jQuery.noConflict();
		if(typeof(console) != 'object')
		{
			console = { log: function(){}}
		}
		/**
   * Retrieve the coordinates of the given event relative to the center
   * of the widget.
   *
   * @param event
   *   A mouse-related DOM event.
   * @param reference
   *   A DOM element whose position we want to transform the mouse coordinates to.
   * @return
   *    A hash containing keys 'x' and 'y'.
   */
  getRelativeCoordinates = function (event, reference) {
    var x, y;
    event = event || window.event;
    var el = event.target || event.srcElement;

    if (!window.opera && typeof event.offsetX != 'undefined') {
      // Use offset coordinates and find common offsetParent
      var pos = { x: event.offsetX, y: event.offsetY };

      // Send the coordinates upwards through the offsetParent chain.
      var e = el;
      while (e) {
        e.mouseX = pos.x;
        e.mouseY = pos.y;
        pos.x += e.offsetLeft;
        pos.y += e.offsetTop;
        e = e.offsetParent;
      }

      // Look for the coordinates starting from the reference element.
      var e = reference;
      var offset = { x: 0, y: 0 }
      while (e) {
        if (typeof e.mouseX != 'undefined') {
          x = e.mouseX - offset.x;
          y = e.mouseY - offset.y;
          break;
        }
        offset.x += e.offsetLeft;
        offset.y += e.offsetTop;
        e = e.offsetParent;
      }

      // Reset stored coordinates
      e = el;
      while (e) {
        e.mouseX = undefined;
        e.mouseY = undefined;
        e = e.offsetParent;
      }
    }
    else {
      // Use absolute coordinates
      var pos = getAbsolutePosition(reference);
      x = event.pageX  - pos.x;
      y = event.pageY - pos.y;
    }
    // Subtract distance to middle
    return { x: x, y: y };
  }

		$j(document).ready(
			function()
			{
				// preload bomb pic
				var pic1= new Image(100,100); 
				pic1.src="/images/gui/error_bomb.png"; 
				
				// why isn't this set by ******* default?
				Ext.BLANK_IMAGE_URL = '/images/ext/resources/images/default/s.gif';  // Ext 2.0
				Ext.QuickTips.init();
				OpenCore.RPC.RequestHandler.setOpenCoreURL("/fake-opencore-proxy/json");
				
				OpenCore.DataManager.setRPC(OpenCore.RPC);
				OpenPanel.Controller.setDataManager(OpenCore.DataManager);
				
				OpenPanel.Controller.setGuiBuilder(OpenPanel.GUIBuilder);
				OpenPanel.GUIBuilder.GUIElements.ItemList.setGuiBuilder(OpenPanel.GUIBuilder);
				OpenPanel.GUIBuilder.GUIElements.ItemList.setController(OpenPanel.Controller);
				OpenPanel.GUIBuilder.GUIElements.FormObject.setGuiBuilder(OpenPanel.GUIBuilder);
				OpenCore.RPC.RequestHandler.startLoading = OpenPanel.GUIBuilder.showLoadingDiv;
				OpenCore.RPC.RequestHandler.doneLoading = OpenPanel.GUIBuilder.hideLoadingDiv;
				var el = document.getElementById("b");
				var buttonText = el.innerHTML;
				
				var button = document.createElement("div");
				//button.setAttribute("type", "submit");
				//button.className = "buttonA";
				el.appendChild(button);
				console.log(getRelativeCoordinates(123,123));
				
				var t = document.createElement("table");
				t.setAttribute("border", "0");
				t.setAttribute("cellpadding", "0");
				t.setAttribute("cellspacing", "0");t
				t.style.cssText="border-collapse: collapse";
				var tb = document.createElement("tbody");
				var tr = document.createElement("tr");
				var left = document.createElement("td");
				var center = document.createElement("td");
				var right = document.createElement("td");
				var txt = document.createTextNode(buttonText);
				t.appendChild(tb);
				tb.appendChild(tr);
				tr.appendChild(left);
				tr.appendChild(center);
				tr.appendChild(right);
				center.appendChild(txt);
				button.appendChild(t);
				
				button.onmouseover = button.onfocus = function(){
					left.className = "buttonLeftOver";
					right.className = "buttonRightOver";
					center.className = "buttonCenterOver";
				}
			
				button.onmouseout = button.onblur = function(){
					left.className = "buttonLeft";
					right.className = "buttonRight";
					center.className = "buttonCenter";
				}
				button.onmouseout();
						
				}
				
				
		);

			
	</script>
  </head>
  <body>
   	<form onsubmit="alert(123); return false;">
   		<div id="b"></div>
	</form>
	<div id="c">
		<table border="0" cellpadding="0" cellspacing="0">
			<tbody>
				<tr>
					<td class="buttonLeft"></td>
					<td class="buttonCenter">123</td>
					<td class="buttonRight"></td>
				</tr>
			</tbody>
		</table>
	</div>
  </body>
</html>